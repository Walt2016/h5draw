!function(t,e){if("function"==typeof define&&define.amd)define("tpler",[],e);else if("object"==typeof module&&module.exports)module.exports=e();else if(t)t.tpler=e();else{e()}}(this,function(){function TimeCom(t){var e;e=""==t?new Date:new Date(t),this.year=e.getFullYear(),this.month=e.getMonth()+1,this.day=e.getDate(),this.hour=e.getHours(),this.minute=e.getMinutes(),this.second=e.getSeconds(),this.msecond=e.getMilliseconds(),this.week=e.getDay()}function template(t){return new template.prototype.init(t)}var reg_tpl_tag=/{=(.*?)(?:\|(.*?))?}/g,reg_operation_symbol=/[\+|\-|\*|\/|\(|\)]+/g,rootEl,$index=1,$length=1,toucher,customFilters={},customSyntax="",customMethods={},customDirectives={},templateConfig={},SYNTAX="syntax",GROUP="group",LAZY="lazy",MORE="more",DEFAULT="default",DATA="data",PAGESIZE="pagesize",KEYWORD="keyword",TEMPLATE="template",NOLOOP="noloop",LOOP="loop",MODEL="model",TAP="tap",LONGTAP="longtap",DRAG="drag",ON="on",BIND="bind",inBrowser="undefined"!=typeof window;console.log("before inBrowser:"+inBrowser);var isSupportTouch=function(){if(!inBrowser)return!1;try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}(),extend=function(t){for(var e=Array.prototype.slice.call(arguments),r=e.length,n=1;n<r;n++){var i=e[n];if(i)for(var o in i)t[o]=i[o]}return t},extendMe=function(t){for(var e=Array.prototype.slice.call(arguments),r=e.length,n=1;n<r;n++){var i=e[n];if(i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},env=function(){var t={};if(inBrowser){var e=navigator.userAgent,r=e.match(/(Android)[\s\/]+([\d\.]+)/),n=e.match(/(iPad|iPhone|iPod)\s+OS\s([\d_\.]+)/),i=(e.match(/(Windows\s+Phone)\s([\d\.]+)/),/WebKit\/[\d.]+/i.test(e)),o=!!n&&(navigator.standalone?i:/Safari/i.test(e)&&!/CriOS/i.test(e)&&!/MQQBrowser/i.test(e));r&&(t.android=!0,t.version=r[2]),n&&(t.ios=!0,t.version=n[2].replace(/_/g,"."),t.ios7=/^7/.test(t.version),t.ios11=/^11/.test(t.version),"iPad"===n[1]?t.ipad=!0:"iPhone"===n[1]?t.iphone=!0:"iPod"===n[1]&&(t.ipod=!0)),i&&(t.webkit=!0),o&&(t.safari=!0)}return t}(),UA,isIE,isIE9,isEdge,isAndroid,isIOS,isChrome,weixin,envt,screen={x:100,y:100};inBrowser&&(UA=inBrowser&&window.navigator.userAgent.toLowerCase(),isIE=UA&&/msie|trident/.test(UA),isIE9=UA&&UA.indexOf("msie 9.0")>0,isEdge=UA&&UA.indexOf("edge/")>0,isAndroid=UA&&UA.indexOf("android")>0,isIOS=UA&&/iphone|ipad|ipod|ios/.test(UA),isChrome=UA&&/chrome\/\d+/.test(UA)&&!isEdge,weixin=UA&&"micromessenger"==UA.toLowerCase().match(/MicroMessenger/i),envt=extend(env,{inBrowser:inBrowser,UA:UA,isIE:isIE,isIE9:isIE9,isEdge:isEdge,isAndroid:isAndroid,isIOS:isIOS,isChrome:isChrome,weixin:weixin}),screen={x:inBrowser?document.documentElement.clientWidth:100,y:inBrowser?document.documentElement.clientHeight:100});var _={envt:envt,extend:extend,extendMe:extendMe,screen:screen,toDate:function(t){return/^\d*$/.test(t)?new Date(Number(t)):_.isString(t)?new Date(Date.parse(t.replace(/-/g,"/"))):t},dateAdd:function(t,e,r){var r;switch(r=_.isString(r)?_.toDate(r):new Date(r),t.toLowerCase()){case"y":case"year":return new Date(r.setFullYear(r.getFullYear()+e));case"m":case"month":return new Date(r.setMonth(r.getMonth()+e));case"d":case"day":return new Date(r.setDate(r.getDate()+e));case"w":case"week":return new Date(r.setDate(r.getDate()+7*e));case"h":case"hour":return new Date(r.setHours(r.getHours()+e));case"n":case"min":case"minute":return new Date(r.setMinutes(r.getMinutes()+e));case"s":case"second":return new Date(r.setSeconds(r.getSeconds()+e));case"l":case"ms":case"msecond":return new Date(r.setMilliseconds(r.getMilliseconds()+e))}},dateDiff:function(t,e,r){var n,i=new TimeCom(e),o=new TimeCom(r);switch(String(t).toLowerCase()){case"y":case"year":n=i.year-o.year;break;case"m":case"month":n=12*(i.year-o.year)+(i.month-o.month);break;case"d":case"day":n=Math.round((Date.UTC(i.year,i.month-1,i.day)-Date.UTC(o.year,o.month-1,o.day))/864e5);break;case"h":case"hour":n=Math.round((Date.UTC(i.year,i.month-1,i.day,i.hour)-Date.UTC(o.year,o.month-1,o.day,o.hour))/36e5);break;case"n":case"min":case"minute":n=Math.round((Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute)-Date.UTC(o.year,o.month-1,o.day,o.hour,o.minute))/6e4);break;case"s":case"second":n=Math.round((Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute,i.second)-Date.UTC(o.year,o.month-1,o.day,o.hour,o.minute,o.second))/1e3);break;case"l":case"ms":case"msecond":n=Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute,i.second,i.msecond)-Date.UTC(o.year,o.month-1,o.day,o.hour,o.minute,o.second,i.msecond);break;case"w":case"week":n=Math.round((Date.UTC(i.year,i.month-1,i.day)-Date.UTC(o.year,o.month-1,o.day))/864e5)%7;break;default:n="invalid"}return n},timeFormat:function(t){if("number"!=typeof t||t<0)return t;var e=parseInt(t/3600);t%=3600;var r=parseInt(t/60);t%=60;var n=parseInt(t);return[e,r,n].map(function(t){return t=t.toString(),t[1]?t:"0"+t}).join(":")},week:function(t){var e=0,r=_.toDate(t);if(!r)return"";var n=(r.getFullYear(),new Array(12));if(n[0]=31,n[2]=31,n[3]=30,n[4]=31,n[5]=30,n[6]=31,n[7]=31,n[8]=30,n[9]=31,n[10]=30,n[11]=31,Math.round(r.getFullYear()/4)==r.getFullYear()/4?n[1]=29:n[1]=28,0==r.getMonth())e+=r.getDate();else{for(var i=r.getMonth(),o=1;o<=i;o++)e+=n[o-1];e+=r.getDate()}var a=Math.round(e/7);return a},month:function(t){var e=_.toDate(t);return e?e.getMonth():""},text:function(t){if(_.isElement(t))return t.innerText},html:function(t){if(_.isElement(t))return t.innerHTML},fast:function(){var t=function(t,e,r){var n,i;n=(new Date).getTime();for(var o=1;o<=r;o++)t.call(this);return i=(new Date).getTime(),console.log("fn {"+t.name+"} _run "+r+" times ,last: "+(i-n)+"ms"),i-n},e=Array.prototype.slice.call(arguments),r=e.pop(),n=1e4;_.isNumber(r)?n=r:e.push(r);for(var i=0;i<e.length;i++)e[i]&&t.call(this,e[i],i,n)},equal:function(t,e){if(t===e)return!0;if(_.isArray(t)&&_.isArray(e))return t.toString()==e.toString();if(_.isObject(t)&&_.isObject(e)){if(Object.keys(t).length!=Object.keys(e).length)return!1;for(var r in t)if(!_.equal(t[r],e[r]))return!1;return!0}return _.type(t)==_.type(e)&&t==e},pos:function(t,e){function r(t,e,r){_.isDocument(r)&&(r=document.doctype?window.document.documentElement:document.body),this.x=t,this.y=e,this.time=+new Date,this.el=r,this.width=r.clientWidth,this.height=r.clientHeight,this.scrollTop=r.scrollTop,this.scrollHeight=r.scrollHeight,this.offsetHeight=r.offsetHeight,this.rang={top:e,left:t,right:t+this.width,bottom:e+this.height}}function n(t){for(var e=new r(t.offsetLeft,t.offsetTop,t),n=t.offsetParent;n;)e.x+=n.offsetLeft,e.y+=n.offsetTop,n=n.offsetParent;return i&&(e.x-=i.x,e.y-=i.y),e}var i;if(_.isElement(e)||_.isTouchEvent(t)||_.isMouseEvent(t)?i=_.pos(e):_.isObject(e)&&"Postion"==_.objectName(e)&&(i=e),_.isElement(t)){var o=t;return n(o)}if(_.isTouchEvent(t)||_.isMouseEvent(t)){var a,s,c=t,o=c.currentTarget,l=c.touches&&c.touches.length>0?c.touches:c.changedTouches;if(l&&0!==l.length){var u=l[0];a=u.pageX,s=u.pageY}else a=c.clientX,s=c.clientY;return i&&(a-=i.x,s-=i.y),new r(a,s,o)}if(_.isString(t)){var o=_.query(t);return _.pos(o)}},drag:function(t){toucher({el:t,type:"drag"})},parseUrl:function(t){var e,r,n,i={},o=location.hash,a=o,t=t||window.location.href;t.replace(/http[s]?:\/\/([^:]*?)(?::(\d+))?\//,function(t,i,o){e=t.substring(0,t.length-1),r=i,n=o});var s=function(){var e=t.match(/#(.*)$/);return e?e[1]:""},c=function(t){return decodeURI(t.replace(/%25/g,"%2525"))},l=function(){var t=location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},u=function(){var t=c(location.pathname+l()).slice(0);return"/"===t.charAt(0)?t.slice(1):t},h=u();return o=s(),t.replace(/[?&](.+?)=([^&#]*)/g,function(_,t,e){i[t]=decodeURI(e)}),o&&(o=o.length>1?o.replace(/#+/g,"#"):"",a=o.replace(/#/g,"")),{params:i,hash:o,route:a,path:h,domain:e,host:r,port:n}},guid:1,uId:function(){return Math.random().toString(16).slice(2)},random:function(t,e,r){if(_.isArray(t))return t[Math.floor(Math.random()*t.length)];if(_.isNumber(t))return Math.floor(Math.random()*t);for(var n=r||"_",e=e||6,t=t||"abcdefghijklmnopqrstuvwxyz",i=0;i<e;i++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},between:function(t,e){return t+Math.round((e-t)*Math.random())},autoid:function(t,e){var r=function(t){return _.isDocument(t)?t:(_.isElement(t)&&(e?t.setAttribute("id",_.random()):_.isEmpty(t.id)&&t.setAttribute("id",_.random())),t)};if(_.isArray(t)){var n=[];return t.forEach(function(t){n.push(r(t))}),n}return r(t)},query:function(t){var e=Array.prototype.slice.call(arguments),r=e.length;if(r>1&&(t=e.join(",")),_.isWindow(t)||_.isDocument(t))return t;if(_.isFunction(t))return t(),[];var n=function(t){if(_.isElement(this)&&(_.autoid(this),this.id)){var e=t.split(","),r="#"+this.id;t=r+e.join(","+r)+","+r+" "+e.join(","+r+" ")}return t};if(_.isElement(t)){if(_.autoid(t),!_.isElement(this))return t;t="#"+t.id,t=n.call(this,t)}else{if(_.isArray(t)){var i=[];return t.forEach(function(t){i.push(_.query(t))}),i}if(_.isJQuery(t)){if(1==t.length)return t.get(0);for(var i=[],o=0;o<t.length;o++)i.push(t.get(o));return i}t=n.call(this,t)}try{var a=document.querySelectorAll(t),e=Array.prototype.slice.call(a),r=e.length;if(0==r)return[];if(1==r)return _.autoid(e[0]);if(r>1)return _.autoid(e)}catch(s){console.log(s);var c=t.split(":");return c.length>1?_.query(c[0]).filter(c[1]):[]}},json:function(str){if(_.isEmpty(str))return{};try{return JSON.parse(str)}catch(e1){console.log(e1);try{return eval("("+str+")")}catch(e2){return console.log(e2),e2}}},capitalize:function(t){var e=Array.prototype.slice.call(arguments),r=e.length;if(r>1)return _.capitalize.call(this,e);if(_.isArray(t)){var n=[];return t.forEach(function(t){n.push(_.capitalize(t))}),n}return t.substring(0,1).toUpperCase()+t.substring(1)},camelCase:function(t){var e=Array.prototype.slice.call(arguments),r=e.length;return r>1?e[0]+_.capitalize(e.slice(1)).join(""):_.isArray(t)?t[0]+_.capitalize(t.slice(1)).join(""):e[0]},camel2underscode:function(t){return t.match(/^[a-z][a-z0-9]+|[A-Z][a-z0-9]*/g).join("_").toLowerCase()},copy:function(t,e){const r=document.createRange();r.selectNode(t);const n=window.getSelection();n.rangeCount>0&&n.removeAllRanges(),n.addRange(r);try{document.execCommand("copy",e||!1,null)?console.log("copy ok"):console.log("copy fail")}catch(i){console.log(i),console.log("unable to copy")}},stringify:function(t,e){var r,n,i=[],o="";if(_.isUndefined(t))o="undefined";else if(_.isBoolean(t))o=t?"true":"false";else if(_.isString(t))o='"'+t+'"';else if(_.isNumber(t))o=t;else if(_.isDocument(t))o="#document";else if(_.isElement(t))o=t.tagName.toLowerCase(),o+=t.id?"#"+t.id:"",o+=t.className?"."+t.className.replace(/\s+/g,"."):"";else if(_.isFunction(t))o=t.prototype?"function "+t.prototype.constructor.name+"(){}":"function(){}";else if(_.isArray(t))t.forEach(function(t){i.push(_.stringify(t))}),o="["+i.join(",")+"]";else if(_.isMouseEvent(t))o="MouseEvent",o+="("+_.stringify(t.target)+")";else if(_.isTouchEvent(t))o="TouchEvent",o+="("+_.stringify(t.target)+")";else if(_.isNull(t))o+="null";else if("object"==typeof t){for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i.push('"'+r+'":'),n=t[r],_.isArray(n)?n.forEach(function(t){i.push(_.stringify(t))}):i.push(_.stringify(n)),i.push(","));i.pop(),o="{"+i.join("")+"}"}else o=_.isInfinity(t)?"Infinity":"unknowtype";return o},toJSONString:function(t){return _.isObject(t)?JSON.stringify(t):t},color:function(){return this.rgba()},rgb:function(t){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)},hsl:function(){return"hsl("+Math.ceil(360*Math.random())+",50%,50%)"},hsla:function(){return"hsla("+Math.ceil(360*Math.random())+",50%,50%,0.5)"},deepColor:function(){var t=3*Math.random()<<0,e=[255,255,255].map(function(e,r){return r==t?80*Math.random()<<0:e*Math.random()<<0});return"rgb("+e.join(",")+")"},rgba:function(t,e,r,n){var i=Array.prototype.slice.call(arguments),o=i.length;if(o<4)var a=.1,s=.7,n=(a+(s-a)*Math.random()).toFixed(1);if(o<3)var r=1;if(o<2)var e=1;if(o<1)var e=1;var c=[t,e,r];if(t*e*r==1)c=c.map(function(t){return Math.floor(255*Math.random())});else if(t+e+r==0){var l=Math.floor(255*Math.random());c=[l,l,l]}else{var u=155,h=Math.floor(Math.random()*(255-u)+u);c=c.map(function(t){return 1==t?Math.floor(Math.random()*(255-u)+u):Math.floor(Math.random()*(h/2))})}return c.push(n),"rgba("+c.join(",")+")"},colorRgb:function(t){var e=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,r=t.toLowerCase();if(r&&e.test(r)){if(4===r.length){for(var n="#",i=1;i<4;i+=1)n+=r.slice(i,i+1).concat(r.slice(i,i+1));r=n}for(var o=[],i=1;i<7;i+=2)o.push(parseInt("0x"+r.slice(i,i+2)));return"RGB("+o.join(",")+")"}return r},colorHex:function(t){var e=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(/^(rgb|RGB)/.test(t)){for(var r=t.replace(/(?:|||rgb|RGB)*/g,"").split(","),n="#",i=0;i<r.length;i++){var o=Number(r[i]).toString(16);"0"===o&&(o+=o),n+=o}return 7!==n.length&&(n=t),n}if(!e.test(t))return t;var a=t.replace(/#/,"").split("");if(6===a.length)return t;if(3===a.length){for(var s="#",i=0;i<a.length;i+=1)s+=a[i]+a[i];return s}},gradientColor:function(t,e,r){var n,i,o,a=this.colorRgb(t);a.replace(/(\d{1,3}),(\d{1,3}),(\d{1,3})/g,function(t,e,r,a){n=Number(e),i=Number(r),o=Number(a)});var s,c,l,u=this.colorRgb(e);u.replace(/(\d{1,3}),(\d{1,3}),(\d{1,3})/g,function(t,e,r,n){s=Number(e),c=Number(r),l=Number(n)}),sR=(s-n)/r,sG=(c-i)/r,sB=(l-o)/r;for(var h=[],f=0;f<r;f++){var p="rgba("+parseInt(sR*f+n)+","+parseInt(sG*f+i)+","+parseInt(sB*f+o)+",0.5)";h.push(p)}return h},isHtml:function(t){return/<(\S*?) [^>]*>.*?<\/\1>|<.*?\/?>/.test(t)},enHtml:function(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")},deHtml:function(t){return t.replace(/&lt;/g,"<").replace(/&gt;/g,">")},preHtml:function(t){return t.replace(/\n/g,"<br>").replace(/\r/g,"<br>")},getBody:function(t){var e=/<body[^>]*>([\s\S]*)<\/body>/i,r=t.match(e);return r&&r.length>1?r[1]:t},markdown:function(t){_.isEmpty(t)&&(t='# 标题  ## 标题2  \n*粗体*  **粗体**  _斜体_ \n***分割___分割---  \n> 引用1 \n> 引用2 \n* 列表项目1 \n* 列表项目2 \n- 列表项目1 \n- 列表项目2 \n+ 列表1\n+ 列表2 \n 1. 列表1\n2. 列表2 \n [1连接](www.xxx.com) [2连接](www.xxx.com) [3连接](www.xxx.com) [4连接](www.xxx.com) [5连接](www.xxx.com)\n[Ivan Dementev][]\n[Ivan Dementev]: https://github.com/DiVAN1x \n|表格|字段1|字段2|\n|---|---|---|\n|你好|呵呵|吼吼|\n`for(var i=0;i<10,i++) if(i>=5) alert("")`',console.log(t.replace(/\r?\n/g,"\\r\\n\r\n")));for(var e,r,n=[{tag:"blockquote",reg:/(>\s.+\r?\n)+/g},{tag:"table",reg:/(\|.+\|\r?\n)+/g},{tag:"h6",reg:/#{6}\s(.+)/g},{tag:"h5",reg:/#{5}\s(.+)/g},{tag:"h4",reg:/#{4}\s(.+)/g},{tag:"h3",reg:/#{3}\s(.+)/g},{tag:"h2",reg:/#{2}\s(.+)/g},{tag:"h1",reg:/#{1}\s(.+)/g},{tag:"img",reg:/!\[(.*?)\]\((.*?)\)/g},{tag:"marklink",reg:/\[(.*?)\]\[(.*?)\]/},{tag:"ref",tag:/\[.*?\]:\s+(https?:\/\/.+)/},{tag:"a",reg:/\[(.*?)\]\((.*?)\)|(https?:\/\/.+)/g},{tag:"hr",reg:/[\*|\-|_]{3,}/g},{tag:"strong",reg:/\*\*(.*?)\*\*/g},{tag:"em",reg:/\*(.*?)\*/g},{tag:"i",reg:/[\s\n]_(.*?)_[\s|\n]/g},{tag:"ul",reg:/(?:-\s[\s\S]*)?-\s.*(\r?\n|$)/g},{tag:"ul",reg:/(?:\*\s[\s\S]*)?\*\s.*(\r?\n|$)/g},{tag:"ol",reg:/(\+\s.+\r?\n)+|(\d\.\s.+\r?\n)+/g},{tag:"code",reg:/`([\s\S]+)`/g},{tag:"br",reg:/\r?\n/g}],i=function(t,e){var r=[];r.push("<"),r.push(t);for(var n in e)r.push(" "+n+'="'+e[n]+'"');return r.push(">"),r.join("")},o=function(t){return"</"+t+">"},a=function(t,e,r){return e?i(t,r)+e+o(t):i(t,r)},s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},c=function(){var t=_.keys(s),e=new RegExp("["+t.join("")+"]","g");return this.replace(e,function(t){return s[t]})},l=function(t,e){var r=this;return this.replace(e,function(e,n,i,o){switch(t){case"ref":return"";case"marklink":i=i||n;var s=new RegExp("\\["+i+"\\]:(.*?)\\r?\\n","i"),o=r.match(s)[1];return r=r.replace(s,""),a("a",n,o);case"img":return a(t,null,{alt:n,src:i});case"a":return a(t,n||e,{href:i||o});case"br":case"hr":return a(t);case"blockquote":return e=c.call(e),a(t,e);case"ul":return e=l.call(e,"li",/[\*-]\s([\s\S]+?)(?:\n|$)/g),a(t,e);case"ol":return e=l.call(e,"li",/[(?:\d+\.)|\+]\s(.+)\r?\n/g),a(t,e);case"tr":var u=n.split("|").join("</td><td>");return u=a("td",u),a("tr",u);case"table":e=e.replace(/\|.*[\-]{3,}.*\|[\r?\n]/g,"");var h=l.call(e,"tr",/\|(.+)\|[\r?\n]/g);return a(t,h);case"h1":return a(t,n);case"i":return a(t,n);case"li":return a(t,n);case"code":return n=c.call(n),a(t,n);default:return a(t,n)}})},u=0,h=n.length;u<h;u++)e=n[u].reg,r=n[u].tag,t=l.call(t,r,e);return a("article",t,{"class":"markdown-body entry-content"})},isShow:function(t){return t=_.isElement(t)?t:_.query(t),t.offsetWidth>0||t.offsetHeight>0},isHide:function(t){return t=_.isElement(t)?t:_.query(t),t.offsetWidth<=0&&t.offsetHeight<=0},hasClass:function(t){var e=this;return _.isJQuery(e)&&(e=e.get(0)),!!_.isElement(e)&&e.className.split(" ").indexOf(t)!=-1},addClass:function(t){var e=this,r=Array.prototype.slice.call(arguments);1==r.length&&t&&(r=t.split(" "));var n=function(){var e=this;_.isString(e)&&(e=_.query(e)),_.isElement(e)?e.className=_.uniq(e.className.split(" ").concat(r)).join(" "):_.isJQuery(e)?e.addClass(t):_.isArray(e)&&_.each(e,function(t){n.call(t)})};if(n.call(e),_.isArray(e)){var i=e.length;if(0==i)return[];1==i&&(e=e[0])}return e},removeClass:function(t){var e=this,r=Array.prototype.slice.call(arguments);1==r.length&&t&&(r=t.split(" ")),r.length>1&&r.forEach(function(t){_.removeClass.call(e,t)});var n=function(){var e=this;if(_.isString(e)&&(e=_.query(e)),_.isElement(e)){if(e.hasClass(t)){var r=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(r," ").trim()}}else _.isJQuery(e)?e.removeClass(t):_.isArray(e)&&_.each(e,function(e){n.call(e,t)})};if(n.call(e),_.isArray(e)){var i=e.length;if(0==i)return[];1==i&&(e=e[0])}return e},hover:function(t,e){var r=this;return toucher([{el:r,type:"touchstart",callback:function(e,r){e.addClass(t)}},{el:r,type:"touchend",callback:function(r,n){r.removeClass(t),e&&e.call(r,n)}}]),r},tab:function(t,e){var r=this;return toucher([{el:r,type:"touchstart",callback:function(e,r){e.addClass(t).siblings().removeClass(t),_.$("#"+this.attr("target")).show().siblings().hide()}},{el:r,type:"touchend",callback:function(t,r){e&&e.call(t,r)}}]),r},slice:function(t,e){var r=Array.prototype.slice.call(arguments),n=r.length;if(2==n&&_.isArray(t)&&_.isNumber(e)){for(var i=[],o=0;o<Math.ceil(t.length/e);o++){var a=o*e,s=a+e;i.push(t.slice(a,s))}return i}return 0==n?null:1==n?r[0]:r},hasAttr:function(t,e){return _.isElement(t)?!_.isNull(t.getAttribute(e)):_.isJQuery(t)?"undefined"!=typeof t.attr(e):!!_.isString(t)&&(t=_.query(t),_.hasAttr(t,e))},has:function(t,e){var r=function(t){return Object.prototype.hasOwnProperty.call(this,t)};if(_.isObject(t)){var n=e.split("."),i=n.length;if(1==i)return r.call(t,e);for(var o=t,a=0;a<i;a++){var s=n.shift().trim();if(!r.call(o,s))return!1;try{o=o[s]}catch(c){return!1}}return!0}return _.isArray(t)||_.isString(t)?t.indexOf(e)!=-1:!_.isUndefined(t)&&!_.isUndefined(e)&&void 0},focus:function(t){t.onfocus=function(){window.setTimeout(function(){var e,r;try{window.getSelection&&document.createRange?(r=document.createRange(),r.selectNodeContents(t),r.collapse(!0),r.setEnd(t,t.childNodes.length),r.setStart(t,t.childNodes.length),e=window.getSelection(),e.removeAllRanges(),e.addRange(r)):document.body.createTextRange&&(r=document.body.createTextRange(),r.moveToElementText(t),r.collapse(!0),r.select())}catch(n){console.log(n)}},1)},t.focus()},objectName:function(t){return _.isUndefined(t)?_.isUndefined(t):_.isNull(t)?_.isNull(t):t.prototype.constructor?t.prototype.constructor.name:t.__proto__.constructor.name},type:function(t){if(null===t)return"null";var e=Object.prototype.toString.call(t),r=e.match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===r){if(isNaN(t))return"nan";if(!isFinite(t))return"infinity"}return r},isElement:function(t){return!(!t||1!==t.nodeType&&9!==t.nodeType)},isDocument:function(t){return!(!t||!t.nodeName||9!==t.nodeType)},isImage:function(t){return"htmlimageelement"==_.type(t)},isCanvas:function(t){return"htmlcanvaselement"==_.type(t)},isImgLoad:function(t){return isIE?"complete"==t.readyState:t.complete},loadImg:function(t,e){var r;if(_.isImage(t))r=t;else if(_.isCanvas(t)){var n=t;r=new Image,r.src=n.toDataURL("image/jpeg")}else r=new Image,r.src=t;_.isImgLoad(r)?e&&e.call(r,r):(addEvent("load",r,function(){e&&e.call(r,r)}),r.onerror=function(t){console.log("加载图片失败："+t.path[0].src)})},toDataURL:function(t,e){var r=function(t){var r=document.createElement("canvas"),n=r.getContext("2d"),i=t.width,o=t.height;r.width=i,r.height=o,n.drawImage(t,0,0,i,o);var a=new Image;a.onload=function(){e&&e(a)},a.src=r.toDataURL("image/jpeg")};_.loadImg(t,r)},toCanvas:function(t,e){var r=function(t){var r=document.createElement("canvas"),n=r.getContext("2d"),i=t.width,o=t.height;r.width=i,r.height=o,n.drawImage(t,0,0,i,o),e&&e(r)};_.loadImg(t,r)},cutImg:function(t,e,r,n){var e=_.isUndefined(e)?3:e,r=_.isUndefined(r)?3:r,i=function(t){var i=document.createElement("canvas"),o=i.getContext("2d"),a=t.width,s=t.height;i.width=a,i.height=s;for(var c=[],l=a/e,u=s/r,h=0,f=0;f<r;f++)for(var p=0;p<e;p++){o.drawImage(t,p*l,f*u,l,u,0,0,a,s);var d=new Image;d.src=i.toDataURL("image/jpeg"),d.width=l,d.height=u,d.className="thumbnail",d.id="_thumbnail_"+h++,c.push(d)}n&&n(c)};_.loadImg(t,i)},zipImg:function(t){var e=document.createElement("canvas"),r=t.img,n=t.width,i=t.height,o=t.quality,a=t.zoom,s=t.callback;_.loadImg(r,function(){_.isUndefined(n)&&_.isUndefined(i)&&!_.isUndefined(a)&&(n=this.width*a,i=this.height*a),e.width=n,e.height=i;var t=e.getContext("2d");t.drawImage(this,0,0,n,i);var r=new Image;r.src=e.toDataURL("image/jpeg",o),_.loadImg(r,s)})},reverse:function(t,e){var r=function(t){var r=document.createElement("canvas"),n=r.getContext("2d"),i=t.width,o=t.height;r.width=i,r.height=o,n.drawImage(t,0,0);for(var a=n.getImageData(0,0,i,o),s=0;s<a.data.length;s+=4)a.data[s]=255-a.data[s],a.data[s+1]=255-a.data[s+1],a.data[s+2]=255-a.data[s+2],a.data[s+3]=255;n.putImageData(a,0,0);var c=new Image;c.src=r.toDataURL("image/jpeg"),e&&e(c)};_.loadImg(t,r)},masic:function(t,e){},timeSeq:function(t,e,r){t.forEach(function(t,n){!function(n){setTimeout(function(){r&&r(t)},(e||500)*n)}(n)})},background:function(t,e){var t=_.query(t);_.loadImg(e,function(e){t.style.backgroundImage='url("'+e.src+'")'})},isJQuery:function(t){return!!t&&!!t.jquery},keys:function(t){if(!_.isObject(t))return[];if(Object.keys)return Object.keys(t);var e=[];for(var r in t)_.has(t,r)&&e.push(r);return e},each:function(t,e,r){if(null==t)return t;if(Array.prototype.forEach&&t.forEach===Array.prototype.forEach)t.forEach(e,r);else if(t.length===+t.length){for(var n=0,i=t.length;n<i;n++)if(e.call(r,t[n],n,t)==={})return}else for(var o=_.keys(t),n=0,i=o.length;n<i;n++)if(e.call(r,t[o[n]],o[n],t)==={})return;return t},any:function(t,e,r){e||(e=function(t){return t});var n=!1;return null==t?n:Array.prototype.some&&t.some===Array.prototype.some?t.some(e,r):(_.each(t,function(t,i,o){if(n||(n=e.call(r,t,i,o)))return{}}),!!n)},contains:function(t,e){return null!=t&&(t==e||(Array.prototype.indexOf&&t.indexOf===Array.prototype.indexOf?t.indexOf(e)!=-1:_.any(t,function(t){return t===e})))},size:function(t){return null==t?0:t.length===+t.length?t.length:_.keys(t).length},filter:function(t,e,r){var n=[];return null==t?n:Array.prototype.filter&&t.filter===Array.prototype.filter?t.filter(e,r):(_.each(t,function(t,i,o){e.call(r,t,i,o)&&n.push(t)}),n)},max:function(t){var e=Array.prototype.slice.call(arguments),r=e.length;r>1&&(t=e);for(var n=_.isArray(t)?t.join(",").split(","):t.split(","),i=0;i<n.length;i++)""==n[i]&&(n.splice(i,1),i--);return n==[]?0:Math.max.apply(Math,n)},min:function(t){var e=Array.prototype.slice.call(arguments),r=e.length;r>1&&(t=e);for(var n=_.isArray(t)?t.join(",").split(","):t.split(","),i=0;i<n.length;i++)""==n[i]&&(n.splice(i,1),i--);return n==[]?0:Math.min.apply(Math,n)},clone:function(t){return _.isObject(t)?_.isArray(t)?t.slice():_.extend({},t):t},invert:function(t){for(var e={},r=_.keys(t),n=0,i=r.length;n<i;n++)e[t[r[n]]]=r[n];return e}};[{key:"hide",reverse:"show"},{key:"active",reverse:"passive"},{key:"disabled",reverse:"available"},{key:"fadeout",reverse:"fadein",type:"animate"},{key:"fadeoutup",reverse:"fadeindown",type:"animate"},{key:"fadeinup",reverse:"fadeoutdown",type:"animate"},{key:"fadeoutleft",reverse:"fadeinright",type:"animate"},{key:"fadeinleft",reverse:"fadeoutright",type:"animate"}].forEach(function(t){_[t.key]=function(){var e=Array.prototype.slice.call(arguments);return"animate"==t.type&&_.removeClass.call(e,t.reverse,"hide"),_.addClass.call(e,t.key)},_[t.reverse]=function(){var e=Array.prototype.slice.call(arguments);return"animate"==t.type?(_.addClass.call(e,t.reverse),_.removeClass.call(e,t.key,"hide")):_.removeClass.call(e,t.key)}}),["Null","Undefined","Array","String","Number","Boolean","Function","RegExp","NaN","Infinity","NodeList","Arguments","Window","TouchEvent","MouseEvent","Screen"].forEach(function(t){_["is"+t]=function(e){return _.type(e)===t.toLowerCase()}}),_.isObject=function(t){return!!_.isElement(t)||"object"===_.type(t)},_.isEmpty=function(t){if(null==t)return!0;if(_.isArray(t)||_.isString(t))return 0===t.length;if(_.isElement(t))return 0==_.size(t);for(var e in t)if(_.has(t,e))return!1;return!0},_.uniq=_.unique=function(t,e,r,n){_.isFunction(e)&&(n=r,r=e,e=!1);var i=r?_.map(t,r,n):t,o=[],a=[];return _.each(i,function(r,n){(e?n&&a[a.length-1]===r:_.contains(a,r))||(a.push(r),o.push(t[n]))}),o},_.identity=function(t){return t},_.every=_.all=function(t,e,r){e||(e=_.identity);var n=!0;return null==t?n:Array.prototype.every&&t.every===Array.prototype.every?t.every(e,r):(_.each(t,function(t,i,o){if(!(n=n&&e.call(r,t,i,o)))return breaker}),!!n)},_.intersection=function(t){var e=Array.prototype.slice.call(arguments,1);return _.filter(_.uniq(t),function(t){return _.every(e,function(e){return _.contains(e,t)})})},_.difference=function(t){var e=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));return _.filter(t,function(t){return!_.contains(e,t)})},_.without=function(t){return _.difference(t,Array.prototype.slice.call(arguments,1))},_.map=_.collect=function(t,e,r){var n=[];return null==t?n:Array.prototype.map&&t.map===Array.prototype.map?t.map(e,r):(_.each(t,function(t,i,o){n.push(e.call(r,t,i,o))}),n)},_.property=function(t){return function(e){return e[t]}},_.pluck=function(t,e){return _.map(t,_.property(e))},_.indexOf=function(t,e){return _.isUndefined(t)||_.isUndefined(e)?-1:_.isAarray(t)?t.indexOf(e):_.isString(t)?t.toLowerCase().indexOf(e.toLowerCase()):void 0};var flatten=function(t,e,r){return e&&_.every(t,_.isArray)?Array.prototype.concat.apply(r,t):(_.each(t,function(t){_.isArray(t)||_.isArguments(t)?e?Array.prototype.push.apply(r,t):flatten(t,e,r):r.push(t)}),r)};_.flatten=function(t,e){return flatten(t,e,[])},_.getVal=function(t,e){var r="",n=e.split("."),i=n.length;if(_.isObject(t)){if(1==i)r=t[e];else if(r=t[n.shift()],i-=1,_.isObject(r))for(var o=0;o<i;o++)if(r=r[n[o]],_.isUndefined(r))return r="",""}else(_.isString(t)||_.isNumber(t))&&"text"==e&&(r=t);return r},_.$=_.query;var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(t){_[t]=function(e){return null==e?"":(""+e).replace(entityRegexes[t],function(e){return entityMap[t][e]})}}),_.toQueryPair=function(t,e){return encodeURIComponent(String(t))+"="+encodeURIComponent(String(e))},_.toQueryString=function(t){var e=[];for(var r in t)e.push(_.toQueryPair(r,t[r]));return e.join("&")},_.ajax=function(t){function e(){try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){i=!1}}i||"undefined"==typeof XMLHttpRequest||(i=new XMLHttpRequest)}function r(){if(e(),i)try{i.onreadystatechange=n,"GET"===s.method?(s.data&&(t+=(t.indexOf("?")>-1?"&":"?")+s.data,s.data=null),i.open("GET",t,s.isAsync),i.setRequestHeader("Content-Type",s.contentType||"text/plain;charset=UTF-8"),i.send()):"POST"===s.method?(i.open("POST",t,s.isAsync),i.setRequestHeader("Content-Type",s.contentType||"application/x-www-form-urlencoded;charset=UTF-8"),i.send(s.data)):(i.open(s.method,t,s.isAsync),i.send())}catch(r){console.log(r)}}function n(){if(o)return!0;var e={},r=e.responseText=i.responseText;if(e.responseXML=i.responseXML,e.data=s.data,e.status=i.status,e.uri=t,e.arguments=s.arguments,"json"===s.dataType)try{r=e.responseJSON=JSON.parse(i.responseText)}catch(n){}if(4==i.readyState){switch(i.status){case 200:s.success.call(r,r);break;default:var a={400:"错误的请求！\nError Code:400!",403:"拒绝请求！\nError Code:403!",404:"请求地址不存在！\nError Code:404!",500:"内部错误！\nError Code:500!",503:"服务不可用！\nError Code:503!"},c=a[i.status]?a[i.status]:"请求返回异常！\nError Code:"+i.status;console.log(c),s.error(e)}return o=!0}s.error(e);var l={0:"Uninitialized",1:"Loading",2:"Loaded",3:"Interactive",4:"Complete"};return console.log(t+" ("+l[i.readyState]+")"),!1}var i=!1,o=!1,a=0,s={method:"GET",data:null,arguments:null,success:function(){},error:function(){},complete:function(){},isAsync:!0,timeout:3e4,contentType:null,dataType:"json"},c=Array.prototype.slice.call(arguments),l=c.length;l>=2&&(_.isFunction(c[1])?s=_.extend(s,{success:c[1]}):_.isObject(c[1])&&(s=_.extend(s,c[1]),_.isObject(s.data)&&(s.data=_.toQueryString(s.data)))),l>=3&&_.isFunction(c[2])&&(s=_.extend(s,{error:c[2]}));var u=function(){return o?void(a=0):a>=5?(console.log("请求超时"),void(a=0)):(a++,o=n(),void setTimeout(u,100*(a+1)))};r(),setTimeout(u,15)},_.get=function(t,e){_.ajax(t,e,"GET")},_.post=function(t,e){_.ajax(t,e,"POST")},_.loading=function(t,e,r){if(_.isString(t)&&(t=_.query(t)),_.isElement(t)){var n=["~oo~","^oo^","^oo~","~oo^"],i=!1,o=function(){i||setTimeout(function(){t.query(".tip").text(n.random()),o()},100)};r&&o(),setTimeout(function(){i=!0,t.hide(),e&&e()},1e3)}},_.loadFile=function(t,e,r){var n=t.query("data-file".brackets()),i=function(t,r){_.isFunction(e)?e.call(t,t,r):t.html(r)},o=function(t,e){_.isFunction(r)&&r.call(t,t,e)};_.isElement(n)?_.ajax(n.attr("data-file"),function(t){i(n,t)},function(t){o(n,t)}):_.isArray(n)&&n.forEach(function(t){_.ajax(t.attr("data-file"),function(e){i(t,e)},function(e){o(t,e)})})},_.updateAfterImgLoad=function(t,e){function r(t){o.each(function(){if(0===this.height)return a=!1,!1}),a?(clearTimeout(n),t()):(a=!0,n=setTimeout(function(){r(t)},500))}var n,i=_.query("#"+t),o=i.query("img"),a=!0;o&&o.length>0&&r(function(){e&&e()})},_.polyfill=function(t,e,r){for(var n=0,i=e.length;n<i;n++){var o=t[e[n]];if(_.isFunction(o))return 0==n?o:t[e[0]]=o}return t[e[0]]=r},_.selectorMatches=function(t,e){var r=Element.prototype,n=r.matches||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||function(t){return Array.prototype.slice.call(document.querySelectorAll(t)).indexOf(this)!==-1};return n.call(t,e)},_.closest=function(t){for(var e=this;e;){if(e&&_.selectorMatches(e,t))return e;e=e.parentElement}return[]};var lookupIterator=function(t){return null==t?_.identity:_.isFunction(t)?t:_.property(t)};_.sortBy=function(t,e,r){return e=lookupIterator(e),_.pluck(_.map(t,function(t,n,i){return{value:t,index:n,criteria:e.call(r,t,n,i)}}).sort(function(t,e){var r=t.criteria,n=e.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(r<n||void 0===n)return-1}return t.index-e.index}),"value")};var _prototype={};_prototype.obj={cmd:function(str){if(!_.isString(str))return console.log("object.cmd need a string argument"),"";var self=this,symbol=str.match(reg_operation_symbol),ps=[],_cmd=function(t){if(0==symbol.length)return void ps.push("self."+t);var e=symbol.shift(),r=t.indexOf(e),n=t.substring(0,r).trim();_.has(self,n)?ps.push("self."+n+e):ps.push(n+e);var i=t.substring(r+e.length);_cmd(i)};return _cmd(str),eval(ps.join(""))}},_prototype.num={
isEqual:function(t,e){return e=void 0==e?10:e,this.toFixed(e)===t.toFixed(e)},add:function(t){var e,r,n;try{e=t.toString().split(".")[1].length}catch(i){console.log(i),e=0}try{r=this.toString().split(".")[1].length}catch(i){console.log(i),r=0}n=Math.pow(10,Math.max(e,r));var o=Math.round(t*n+this*n)/n;return o.isInfinity(function(){console.log(e+" "+r+"  "+this+" "+t)}),o},sub:function(t){var e,r,n,i;try{e=this.toString().split(".")[1].length}catch(o){console.log(o),e=0}try{r=t.toString().split(".")[1].length}catch(o){console.log(o),r=0}return n=Math.pow(10,Math.max(e,r)),i=e>=r?e:r,((this*n-t*n)/n).toFixed(i)},mul:function(t){var e=0,r=t.toString(),n=this.toString();try{e+=r.split(".")[1].length}catch(i){console.log(i)}try{e+=n.split(".")[1].length}catch(i){console.log(i)}return Number(r.replace(".",""))*Number(n.replace(".",""))/Math.pow(10,e)},div:function(t){var e,r,n,i,o=0,a=0;try{o=this.toString().split(".")[1].length}catch(s){console.log(s)}try{a=t.toString().split(".")[1].length}catch(s){console.log(s)}return 0==a&&0==o?n=this/t:(e=Number(this.toString().replace(".","")),r=Number(t.toString().replace(".","")),o<a?(i=Math.pow(10,a-o),n=e/r*i):o>a?(i=Math.pow(10,o-a),n=Math.round(e/r)/i):n=e/r),n.isInfinity(function(){console.log(e+" "+r+" "+(a-o)+" "+this+" "+t)}),n},isInfinity:function(t){var e=function(){return this.toString().indexOf(".")>0&&this.toString().split(".")[1].length>5&&(t&&t.call(this),!0)};return e.call(this)}},_prototype.str={pound:function(){return"#"+this},brackets:function(t){if(t){var e;_.isElement(t)?(_.autoid(t),e=t.id):_.isString(t)&&(e=t);var r=this.split(",");return"#"+e+"["+r.join("],#"+e+"[")+"],#"+e+" ["+r.join("],#"+e+" [")+"]"}var r=this.split(",");return"["+r.join("],[")+"]"},format:function(){for(var t=Array.prototype.slice.call(arguments),e=t.length,r=this,n=0,i=e;n<i;n++)r=r.replace(/{.*?}/,t[n]);return r}},_prototype.dat={format:function(t){var e,r={"M+":this.getMonth()+1,"d+|D+":this.getDate(),"h+|H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+|Y+)/.test(t)&&(e=RegExp.$1,t=t.replace(e,(this.getFullYear()+"").substr(4-e.length)));for(var n in r)new RegExp("("+n+")").test(t)&&(e=RegExp.$1,t=t.replace(e,1==e.length?r[n]:("00"+r[n]).substr((""+r[n]).length)));return t}},_prototype.ele={length:{value:1,writable:!1},attr:function(t,e){return e?(this.setAttribute(t,e),this):this.getAttribute(t)},remove:function(){this.parentNode&&this.parentNode.removeChild(this)},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(this.removeChild(t),t.textContent="");return this},removeAttr:function(t){var e=this,r=t.split(","),n=r.length;return 1==n?e.removeAttribute(t):r.forEach(function(t){e.removeAttribute(t)}),e},html:function(t){var e=Array.prototype.slice.call(arguments),r=e.length;return 0==r?this.innerHTML:(this.innerHTML=e[0],this)},text:function(t){return t&&(this.innerText=t),this.innerText},val:function(t){return t?(this.setAttribute("value",t),this):["select","input"].indexOf(this.tagName.toLowerCase())!=-1?this.value:this.getAttribute("value")},on:function(t,e){return addEvent(t,this,e),this},off:function(t,e){return removeEvent(t,this,e),this},trigger:function(t){console.log("event trigger");var e=document.createEvent("UIEvents");return e.initEvent(t,!0,!0),dispatchEvent(e,this),this},each:function(t){_.isFunction(t)&&t.call(this,this,0)},css:function(t){var e=Array.prototype.slice.call(arguments),r=e.length,n=["font-size","line-height","border-radius","border-width","padding","margin"];["padding","margin",""].forEach(function(t){n=n.concat(["top","left","bottom","right"].map(function(e){return t?t+"-"+e:e}))}),["max","min",""].forEach(function(t){n=n.concat(["width","height"].map(function(e){return t?t+"-"+e:e}))});var i=function(t,e){return/^0$/.test(e)?e:n.indexOf(t)>=0?(""+e).replace(/^\d+(\.\d+)?$/,function(t){return t+"px"}):e};if(1==r){if(_.isObject(t))for(key in t){var o=t[key];o=i(key,o),this.style[key]=o}}else 2==r&&(this.style[t]=e[1]);return this},width:function(){var t=Array.prototype.slice.call(arguments),e=t.length;return 1==e&&this.css({width:t[0]}),this.offsetWidth},height:function(){var t=Array.prototype.slice.call(arguments),e=t.length;return 1==e&&this.css({height:t[0]}),this.offsetHeight},pos:function(t){var e=Array.prototype.slice.call(arguments),r=e.length;return 1==r?this.css({position:"absolute",top:t.y,left:t.x}):_.pos.call(this,this)},outerWidth:function(){return _.max(this.scrollWidth,this.offsetWidth,this.clientWidth)+Number(this.style.marginLeft)+Number(this.style.marginRight)},dir:function(t,e,r){for(var n=[],i=void 0!==r;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(i&&jQuery(t).is(r))break;n.push(t)}return n},parent:function(){return this.parentNode},sibling:function(t,e){for(var r=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&r.push(t);return r},siblings:function(){return this.sibling((this.parentNode||{}).firstChild,this)},children:function(t){return this.sibling(t.firstChild)},first:function(){return this},last:function(){return this},filter:function(t){switch(t){case"visible":return _.isShow(this)?this:null;case"hidden":return _.isHide(this)?this:null;default:return this}},append:function(t){return _.isElement(t)?this.appendChild(t):void(_.isString(t)&&(this.innerHTML=this.innerHTML+t))},onTap:function(t){toucher({el:this,type:"tap",listener:t})}},["hide","show","isHide","active","passive"].forEach(function(t){_prototype.ele[t]=function(){return _[t]&&_[t].call(this,this)}}),["$","query","hover","tab","hasAttr","hasClass","addClass","removeClass","closest"].forEach(function(t){_prototype.ele[t]=function(){return _[t]&&_[t].apply(this,arguments)}}),_prototype.arr={query:function(t){var e=[];return _.each(this,function(r){if(_.isElement(r)){var n=_.autoid(r).query(t);_.size(n)>=1&&e.push(n)}}),1==e.length?e[0]:e},each:function(t){_.isFunction(t)&&_.each(this,function(e,r){t.call(e,e,r)})},first:function(){return this[0]},last:function(){return this[this.length-1]},random:function(){return this[Math.floor(Math.random()*this.length)]}},_prototype.arr.$=_prototype.arr.query,["attr","remove","removeAttr","removeClass","addClass","html","filter","append","on","off","trigger","css","addEvent","hide","show","active","passive","clearEvent","hover","tab","siblings"].forEach(function(t){_prototype.arr[t]=function(){var e=Array.prototype.slice.call(arguments),r=e.length;if(0==this.length)return this;if(1==r&&_.isString(e[0])){var n=[];return _.each(this,function(r){_.isElement(r)&&n.push(r[t].apply(r,e))}),n}return _.each(this,function(r){_.isElement(r)&&r[t].apply(r,e)}),this}}),_.extproto=function(t){return _.each(Array.prototype.slice.call(arguments,1),function(e){if(e)try{for(var r in e)if(_.isObject(e[r]))Object.defineProperty(t,r,e[r]);else if(_.isFunction(e[r]))if(Object.prototype.hasOwnProperty.call(t,r))console.log(t,"obj hasOwnProperty "+r);else{t[r]=e[r];var n=Object.getOwnPropertyDescriptor(t,r);n.enumerable=!1,Object.defineProperty(t,r,n)}else Object.prototype.hasOwnProperty.call(t,r)||(t[r]=e[r])}catch(i){console.log(i)}}),t},_.extproto(Object.prototype,_prototype.obj),_.extproto(Number.prototype,_prototype.num),_.extproto(String.prototype,_prototype.str),_.extproto(Date.prototype,_prototype.dat),_.extproto(Array.prototype,_prototype.arr),inBrowser&&_.extproto(Element.prototype,_prototype.ele);var Base64_encode=_.encode=function(t){var e=function(t){return encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode("0x"+e)})};if("undefined"==typeof window)return new Buffer(t).toString("base64");"undefined"!=typeof window.btoa&&window.btoa(e(t));var r,n,i,o,a,s,c,l,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0,f=0,p="",d=[];if(!t)return t;t=e(t);do r=t.charCodeAt(h++),n=t.charCodeAt(h++),i=t.charCodeAt(h++),l=r<<16|n<<8|i,o=l>>18&63,a=l>>12&63,s=l>>6&63,c=63&l,d[f++]=u.charAt(o)+u.charAt(a)+u.charAt(s)+u.charAt(c);while(h<t.length);p=d.join("");var g=t.length%3;return(g?p.slice(0,g-3):p)+"===".slice(g||3)},Base64_decode=_.decode=function(t){var e=function(t){return decodeURIComponent(t.split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))};if("undefined"==typeof window)return new Buffer(t,"base64").toString("utf-8");if("undefined"!=typeof window.atob)return e(window.atob(t));var r,n,i,o,a,s,c,l,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0,f=0,p="",d=[];if(!t)return t;t+="";do o=u.indexOf(t.charAt(h++)),a=u.indexOf(t.charAt(h++)),s=u.indexOf(t.charAt(h++)),c=u.indexOf(t.charAt(h++)),l=o<<18|a<<12|s<<6|c,r=l>>16&255,n=l>>8&255,i=255&l,64===s?d[f++]=String.fromCharCode(r):64===c?d[f++]=String.fromCharCode(r,n):d[f++]=String.fromCharCode(r,n,i);while(h<t.length);return p=d.join(""),e(p.replace(/\0+$/,""))},addEvent=function(t,e,r){_.isFunction(r)?(window.addEventListener?e.addEventListener(t,r,!1):e.attachEvent("on"+t,r),e.events||(e.events=[]),e.events.push({type:t,el:e,listener:r})):_.isArray(r)&&r.forEach(function(r){addEvent(t,e,r)})},removeEvent=function(t,e,r){if(!_.isElement(e))return!1;if(r){window.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent("on"+t,r),e.events||(e.events=[]);for(var n=e.events.length;n--;)e.events[n].type==t&&e.events[n].listener==r&&e.events.splice(n,1)}else e.events&&e.events.forEach(function(t){removeEvent(t.type,t.el,t.listener)})},startPos={},endPos={},offset={},_touchstart=isSupportTouch?"touchstart":"mousedown",_touchend=isSupportTouch?"touchend":"mouseup",_touchmove=isSupportTouch?"touchmove":"mousemove",Events=function(){var t=[];return{store:function(e){return e&&t.push(e),t},filter:function(e){return _.filter(t,function(t){var r=!0;for(x in e)t[x]!=e[x]&&(r=!1);return r})},reset:function(){t=[]},on:function(t,e,r,n){var i=this;switch(isSupportTouch||t!=TAP||(t="click"),t){case TAP:var o=function(t){startPos=_.pos(t)},a=function(o){endPos=_.pos(o);var a=endPos.x-startPos.x,s=endPos.y-startPos.y,c=endPos.time-startPos.time;Math.abs(a)<=5&&Math.abs(s)<=5&&c<200&&(_.isFunction(r)?r.call(e,endPos.el,o):_.isArray(r)&&r.forEach(function(t){t.call(e,endPos.el,o)}),n&&i.off(t,e))};addEvent(_touchstart,e,o),addEvent(_touchend,e,a);break;case LONGTAP:var s,o=function(o){s=setTimeout(function(){_.isFunction(r)?r.call(e,e,o):_.isArray(r)&&r.forEach(function(t){t.call(e,e,o)}),n&&i.off(t,e)},1e3)},a=function(t){s&&clearTimeout(s)};addEvent(_touchstart,e,o),addEvent(_touchend,e,a);break;case DRAG:case"drag-y":case"drag-x":var c,l=function(t){t.preventDefault()},u=document.documentElement.clientWidth-e.clientWidth,h=document.documentElement.clientHeight-e.clientHeight,o=function(t){startPos=_.pos(t),offset=_.pos(e),e.css({position:"absolute",cursor:"move"}),c=!0,addEvent(_touchmove,document,l)},f=function(r){endPos=_.pos(r),c&&function(){var r=endPos.x-startPos.x+offset.x,n=endPos.y-startPos.y+offset.y;r=_.min(r,u),r=_.max(0,r),n=_.min(n,h),n=_.max(0,n),"drag-y"!=t&&e.css({left:r+"px"}),"drag-x"!=t&&e.css({top:n+"px"})}()},a=function(t){endPos=_.pos(t),c=!1,removeEvent(_touchmove,document,l),_.isFunction(r)&&r.call(e,endPos.el,t)};addEvent("mouseover",e,function(t){e.css({cursor:"move"})}),addEvent("mouseout",e,function(t){e.css({cursor:"normal"})}),addEvent(_touchstart,e,o),addEvent(_touchmove,document,f),addEvent(_touchend,document,a);break;default:var p=function(o){_.isFunction(r)?r.call(e,e,o):_.isArray(r)&&r.forEach(function(t){t.call(e,e,o)}),n&&i.off(t,e)};addEvent(t,e,p)}},off:function(t,e,r){TAP==t?(removeEvent(_touchstart,e),removeEvent(_touchend,e)):removeEvent(t,e,r)}}}(),toucher=_.toucher=function(t){return new toucher.prototype.init(t)};toucher.prototype={constructor:toucher,init:function(t){var e=this;if(!t)return void(0==t&&e.offEvent());var r=[],n=function(t){var i=_.query(t.el),o=t.type||"click",a=!!_.isUndefined(t.clear)||t.clear,s=t.listener||t.callback,c=t.once||!1;_.isElement(i)?("input"==i.nodeName.toLowerCase()&&o==TAP&&(o="click"),a&&e.clear({el:i,type:o}),r.push({type:o,el:i,listener:s,once:c})):_.isArray(i)&&i.forEach(function(e){n(_.extend({},t,{el:e}))})};_.isArray(t)?t.forEach(function(t){n(t)}):n(t),e.onEvent(r)},onEvent:function(t){return t.forEach(function(t){Events.store(t),Events.on(t.type,t.el,t.listener,t.once)}),this},offEvent:function(t){return Events.filter(t).forEach(function(t){Events.off(t.type,t.el)}),this},clear:function(t){return this.offEvent(t)}},toucher.prototype.init.prototype=toucher.prototype;var walker=_.walker=function(t){return new walker.prototype.init(t)};walker.prototype={constructor:walker,ch:"",pos:0,line:0,col:0,max:0,text:"",escapee:{'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},init:function(t){if(_.isString(t))this.text=t;else if(_.isNumber(t))this.text=""+t;else{if(!_.isObject(t))throw{name:"input error",messasge:'string or {text:""} is required'};this.text=t.text||"",this.debug=t.debug||!1}return this.max=this.text.length,this.line=0,this.col=0,this.pos=0,this.ch=this.peek(),this},parseTable:function(){this.table=[];for(var t,e=[];this.next();)t=this.until("|"),t&&e.push(t),("\n"===this.ch||this.pos>=this.max)&&(this.table.push(e),e=[]);return this.table},peek:function(t){var e=this.text.charAt(this.pos);if(t){e="";for(var r=0;r<=t;r++)e+=this.text.charAt(this.pos+r>=this.max?this.max:this.pos+r)}return e},eof:function(){return""==this.peek()},next:function(t){return t&&t!==this.ch&&error("Expected '"+t+"' instead of '"+this.ch+"'"),this.ch=this.text.charAt(this.pos++),"\n"==this.ch?(this.line++,this.col=0):this.col++,this.debug&&(this.token=this.peek(10)),this.ch},back:function(){return this.ch=this.text.charAt(this.pos--),this.ch},error:function(t){for(var e="",r=10;r--;)this.next(),e+=this.ch;var n={name:"SyntaxError",message:t,pos:this.pos,ch:this.ch,line:this.line,col:this.col,text:this.text,token:e};console.log(n)},info:function(){return{pos:this.pos,ch:this.ch,line:this.line,col:this.col,text:this.text}},until:function(t){var e="",r=this.ch;if(r===t)for(;r=this.next();){if(r===t)return this.back(),e;if("\n"===r){e="";break}e+=r}return e},json:function(){return this._parseJson()},_parseJson:function(){switch(this._skipWhite(),this.ch){case"{":return this._parseObj();case"[":return this._parseArr();case":":return this._parseJson();case'"':case"'":return this._parseStr();default:return/[\d\.-]/.test(this.ch)?this._parseNum():this._parseValue()}},_parseObj:function(){this._skipWhite();var t,e={};if("{"==this.ch)for(;this.next();){if(this._skipWhite(),"}"==this.ch)return this.next(),e;this.ch&&(t=this._parseKey(),Object.prototype.hasOwnProperty.call(e,t)&&(this.error("Duplicate key '"+t+"'"),console.log(e)),e[t]=this._parseJson())}return e},_parseArr:function(){this._skipWhite();var t=[];if("["==this.ch)for(;this.next();){if(this._skipWhite(),"]"==this.ch)return this.next(),t;if(this.ch){var e=this._parseJson();if(e&&(t.push(e),"]"===this.ch))return this.next(),t}}return t},_skipWhite:function(){for(;this.ch&&this.ch<=" ";)this.next()},_removeQuote:function(t){return t.replace(/(?:^"(.*)"$)|(?:^'(.*)'$)/,"$1$2")},_parseKey:function(){for(var t=this.ch;this.next();){if(":"==this.ch)return this.next(),this._removeQuote(t);t+=this.ch}},_parseStr:function(){this._skipWhite();var t="",e=this.ch;if("\"'".indexOf(e)>=0)for(;this.next();){if(e==this.ch)return this.next(),t;"\\"===this.ch&&(this.next(),this.escapee[this.ch]&&(t+=this.escapee[this.ch])),t+=this.ch}},_parseNum:function(){if(/[\d\.-]/.test(this.ch)){for(var t=this.ch;this.next();){if(",}]".indexOf(this.ch)>=0)return t=+t;t+=this.ch}return t}},_parseValue:function(){for(var t=this.ch;this.next();){if(",}]".indexOf(this.ch)>=0)return this._removeQuote(t);t+=this.ch}return t}},walker.prototype.init.prototype=walker.prototype;var debug=_.debug=function(t){return new debug.prototype.init(t)};debug.prototype={constructor:debug,init:function(t){var e=document.createElement("div");e.className="_console";var r=document.createElement("div");r.className="_console_handle",r.innerHTML="debug";var n=document.createElement("div");n.className="_console_log",e.appendChild(r),e.appendChild(n),_.$("body").appendChild(e),console.log=function(){var t=Array.prototype.slice.call(arguments);template({el:"._console_log",act:"append",template:'<div class="_item">{=result}</div>',data:{result:1==t.length?t[0]:t},callback:function(){this.el.query("._item").removeAttr("style").last().css({color:"red"}).scrollIntoView()}})},toucher([{el:"._console",type:"touchstart",callback:function(t,e){e.preventDefault(),e.stopPropagation()}},{el:"._console_handle",type:"tap",callback:function(t,e){var r=_.$("._console_log");_.isShow(r)?_.hide(r):_.show(r)}}])}},debug.prototype.init.prototype=debug.prototype;var cycle=_.cycle=function(){var t=Array.prototype.slice.call(arguments);return new cycle.prototype.init(t)};cycle.prototype={constructor:cycle,init:function(t){var e=t.length;if(this.index=0,this.values=[],_.isArray(t[0]))this.values=t[0];else if(_.isObject(t[0]))for(var r in t[0]){var n={};n[r]=t[0][r],this.values.push(n)}else this.values.push(t[0]);if(e>=2)if(_.isNumber(t[0]))for(var i=t[0],o=t[1],a=i;a<=o;a++)this.values.push(a);else this.index=t[1];3==e&&(this.text=t[2]),this.length=this.values.length},next:function(){return this.index=this.index>=this.values.length-1?0:this.index+1,this.values[this.index]},prev:function(){return this.index=this.index<=0?this.values.length-1:this.index-1,this.values[this.index]},current:function(){return this.index==-1&&(this.index=0),this.values[this.index]},val:function(){return this.current()},first:function(){return this.length>0?this.values[0]:null},last:function(){return this.length>0?this.values[this.length-1]:null},text:function(t){this.text=t}},cycle.prototype.init.prototype=cycle.prototype,_.sliderCycle=function(t){var e=t.min,r=t.max,n=t.step,i=t.value,o=[],a=0,s=e,c=0,l=0;for(n.toString().replace(/\d+(?:\.(\d+))?/,function(t,e){e&&(l=e.length)});s<=r;)o.push(s),s==i&&(c=a),s=Number((s+n).toFixed(l)),a++;return _.cycle(o,c)},inBrowser&&function(){for(var t=0,e=["ms","moz","webkit","o"],r=0;r<e.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[e[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[r]+"CancelAnimationFrame"]||window[e[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,r){var n=+new Date,i=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+i)},i);return t=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var PIx2=2*Math.PI;_.radian=function(t){return t*Math.PI/180},_.sin=function(t){return Math.sin(t*Math.PI/180)},_.cos=function(t){return Math.cos(t*Math.PI/180)},_.tan=function(t){return Math.tan(t*Math.PI/180)},_.atan=function(t){return Math.atan(t*Math.PI/180)},_.fibonacci=function(t){if(1==t)return[0];if(2==t)return[0,1];for(var e=[0,1],r=0;r<t-2;r++)e.push(e[r]+e[r+1]);return e};var _point=_.point=function(t,e){return new _point.prototype.init(t,e)};_point.prototype={constructor:_point,init:function(t,e){this.coordinate=_.isUndefined(e)?"ra":e;var r=t.x||0,n=t.y||0,i=t.r||0,o=_.isUndefined(t.a)?_.random(360):t.a;if(this.o={x:r,y:n},this.r=i,this.a=o,"square"==t.path)this.x=i*_.atan(o),this.y=i*_.tan(o),o%=360,(o<=45&&o>=0||o>=315&&o<=360)&&(this.x=i),o>=45&&o<=135&&(this.y=i),o>=135&&o<=225&&(this.x=-i),o>=225&&o<=315&&(this.y=-i),this.x+=this.o.x,this.y+=this.o.y;else{var a=this.xy(i,o,this.o);this.x=a.x,this.y=a.y}},xy:function(t,e,r){return{x:r.x+t*_.cos(e),y:r.y+t*_.sin(e)}},distance:function(t){return Math.pow(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2),.5)},middle:function(t,e){var t=t||this.o,e=_.isUndefined(e)?1:e;if("xy"==this.coordinate){var r=t.x*e/(e+1)+1*this.x/(e+1)+this.o.x,n=t.y*e/(e+1)+1*this.y/(e+1)+this.o.y;return{x:r,y:n}}var r=(t.x-this.x)*e/(e+1)+this.o.x,n=(t.y-this.y)*e/(e+1)+this.o.y,i=_.extendMe({},this,{x:r,y:n});return _point(i)},mirror:function(t){var t=t||this.o;if("xy"==this.coordinate)return{x:2*t.x-this.x,y:2*t.y-this.y};var e=_.extendMe({},this,{x:2*(t.x-this.x)+this.o.x,y:2*(t.y-this.y)+this.o.x});return _point(e)},translate:function(t,e){if("xy"==this.coordinate)return{x:this.x+t||0,y:this.y+e||0};var r=_.extendMe({},this,{x:this.o.x+t||0,y:this.o.y+e||0});return _point(r)},rotate:function(t){if("xy"==this.coordinate)return this.xy(this.r,t,this.o);var e=_.extendMe({},this,{a:this.a+t,x:this.o.x,y:this.o.y});return _point(e)},scale:function(t){if("xy"==this.coordinate)return this.xy(this.r*t,0,this.o);var e=_.extendMe({},this,{r:this.r*t});return _point(e)},clone:function(){return _point({x:this.o.x,y:this.o.y,r:this.r,a:this.a})}},_point.prototype.init.prototype=_point.prototype;var _shape=_.shape=function(t,e){return new _shape.prototype.init(t,e)};_shape.prototype={constructor:_shape,init:function(t,e){var r=this;if(t&&(this.draw=t,this.canvas=t.canvas,this.context=t.context),e){var n=_.isUndefined(e.x)?this.canvas.width/2:e.x,i=_.isUndefined(e.y)?this.canvas.height/2:e.y,o=_.isUndefined(e.a)?0:e.a,a=_.isUndefined(e.vx)?1:e.vx,s=_.isUndefined(e.vx)?1:e.vy;n+=e.offsetX||0,i+=e.offsetY||0;var e=this.opt=_.extend({},e,{width:e.r,height:e.r,top:0,left:0,right:this.canvas.width,bottom:this.canvas.height,x:n,y:i,a:o,vx:a,vy:s});_.isArray(e)?e.forEach(function(t){r.setup(t)}):r.setup(e)}},setup:function(t){var e=this,t=t||this.opt,r=t.shape;_.isString(r)&&(r=r.split("|")),r.forEach(function(r){e[r]&&e[r](t)})},rotate:function(t){return this.opt.a+=t||this.opt.speed||1,this},bounce:function(){this.opt.x<this.opt.left+this.opt.width?(this.opt.x=this.opt.width,this.opt.vx=-this.opt.vx):this.opt.y<this.opt.top+this.opt.height?(this.opt.y=this.opt.height,this.opt.vy=-this.opt.vy):this.opt.x>this.opt.right-this.opt.width?(this.opt.x=this.opt.right-this.opt.width,this.opt.vx=-this.opt.vx):this.opt.y>this.opt.bottom-this.opt.height&&(this.opt.y=this.opt.bottom-this.opt.height,this.opt.vy=-this.opt.vy)},move:function(){return this.opt.x+=this.opt.vx||1,this.opt.y+=this.opt.vy||1,this.opt.bounce&&this.bounce(),this},color:function(t){return t&&(this.opt.fill?this.opt.color=_.rgba():this.opt.color=_.rgb()),this},translate:function(t,e){var r=_.extend({},this.opt,{x:this.opt.x+t,y:this.opt.y+e,offsetX:0,offsetY:0});return this.draw.shape(r)},regularVertices:function(t){for(var e=_.point(t),r=t.num,n=360/r,i=[e],o=0;o<r;o++)i.push(e=e.rotate(n));return i},regularPolygon:function(t){var e=this.regularVertices(t);this.draw.link(e,t)},spiral:function(t){for(var e=_.point(t),r=[e],n=t.turns,i=t.r,o=0;o<n;o+=2)r.push(e=e.translate(i*o,0)),r.push(e=e.translate(0,i*o)),r.push(e=e.translate(-i*(o+1),0)),r.push(e=e.translate(0,-i*(o+1)));this.draw.link(r,t)},fibonacci:function(t){function e(t,e,r){var n=Math.PI,s=.5*Math.PI;if(e>2)switch(e%4){case 0:o=o+t-r,n=0,s=1.5*Math.PI;break;case 1:a=a-t+r,n=1.5*Math.PI,s=Math.PI;break;case 2:o=o-t+r,n=Math.PI,s=.5*Math.PI;break;case 3:a=a+t-r,n=.5*Math.PI,s=0}i.arc(o,a,r,n,s,!0)}var r=t.num,n=_.fibonacci(r),i=(t.clockwise,this.context),o=t.x,a=t.y;t.r;this.draw.beginPath(t);for(var s=0;s<n.length;s++)s>=2&&e(n[s-1],s,n[s]);return this.draw.render(_.extend({},t,{closed:!1})),this},vertices:function(t){var e=t.shape,r=t.r||100,n=t.a||0,i=(t.x,t.y,t.rRatio||1),o=(t.aRatio||1,t.turns||1),a=t.num||3,s=t.rRatioType;switch(e){case"star":s="ac",i=[i,1/i];break;case"spiral":r=.01,o=30}for(var c,l=[],u=_.cycle(i||1),h=r,f=0;f<a*o;f++){switch(s){case"cv":h+=r*(u.next()-1);break;case"ac":h=0==f?r:1==f?r*u.val():h*u.next()}c=360*f/a+n;var p=_.point(_.extend({},t,{a:c,r:h}));l.push(p)}return l},invertices:function(t){var e=[],r=t.length;return!(r<2||t[0].distance(t[1])<10)&&(t.forEach(function(n,i){var o;o=i==r-1?n.middle(t[0]):n.middle(t[i+1]),e.push(o)}),e)},circle:function(t){var e=this.context,r=t.x,n=t.y,i=t.r;e.beginPath(),e.arc(r,n,i,0,2*Math.PI,!0),e.closePath(),this.draw.render(t);var o=t.text;return _.isUndefined(o)||(e.fillStyle="#000",e.font="12px Verdana",e.fillText(o,r-4,n+5)),this},ball:function(t){var e=this.context;t.fill=!0;var r=t.x,n=t.y,i=t.r;e.beginPath(),e.arc(r,n,i,0,2*Math.PI),e.closePath(),this.draw.render(t)},ellipse:function(t){var e=this.context,r=t.x,n=t.y,i=t.r,o=t.a||2*i,a=t.b||i;e.save();var i=o>a?o:a,s=o/i,c=a/i;e.scale(s,c),e.beginPath(),e.moveTo((r+o)/s,n/c),e.arc(r/s,n/c,i,0,2*Math.PI),e.closePath(),this.draw.render(t),e.restore()},sector:function(t){var e,r=this.context,n=t.x,i=t.y,o=t.r,a=t.a,s=!0;return s?a-.5*Math.PI:e=a+.5*Math.PI,r.beginPath(),r.arc(n,i,o,a,e,s),r.closePath(),this.draw.render(t),this},ring:function(t){var e=this.context;this.draw.beginPath(t);var r=t.x,n=t.y,i=t.r,o=i*t.rRatio;return e.arc(r,n,i,0,PIx2,!1),e.moveTo(r+o,n),e.arc(r,n,o,PIx2,0,!0),this.draw.closePath(t),this.draw.render(t),this},heart:function(t){},ushape:function(t){},vshape:function(t){},polygon:function(t){var e=this.vertices(t);return this.draw.link(e,t)},line:function(t){return t.num=2,this.polygon(t)},triangle:function(t){return t.num=3,this.polygon(t)},square:function(t){return t.num=4,this.polygon(t)},rectangle:function(t){var e=this.context,r=t.r,n=2*r*_.cos(45),i=2*r*_.sin(45),o=t.x-n/2,a=t.y-i/2;this.draw.beginPath(t),e.rect(o,a,n,i),this.draw.closePath(t),this.draw.render(t)},diamond:function(t){return t.num=4,_.isNumber(t.rRatio)?t.rRatio=[t.rRatio,1/t.rRatio]:t.rRatio=[.5,2],t.rRatioType="ac",this.polygon(t)},star:function(t){return t.shape="star",this.polygon(t),this},diagonal:function(t){for(var e=this.vertices(t),r=[],n=e.length,i=0;i<n-2;i++)for(var o=i+2;o<n;o++)0==i&&o==n-1||r.push([e[i],e[o]]);return this.draw.linkGroup(r,_.extend({},t,{showVertices:!1})),this.draw.link(e,t)},zebra:function(t){var e=this.vertices(t),r=t.x,n=t.y,i=_.slice(e,2).map(function(t){return t.concat([{x:r,y:n}])});return this.draw.linkGroup(i,_.extend({},t,{fill:!0,showVertices:!1,showExcircle:!1})),this.draw.link(e,t)},cross:function(t){for(var e=t.num,r=[],t=_.extend({},t,{num:2*t.num}),n=this.vertices(t),i=0;i<e;i++)r.push([n[i],n[i+e]]);return this.draw.linkGroup(r,t)},ray:function(t){var e=this.vertices(t),r=t.x,n=t.y,i=[];if(t.fill)for(var o=t.num,a=0;a<o;a+=2)i.push([{x:r,y:n},e[a],a==o-1?e[0]:e[a+1]]);else i=e.map(function(t,e){return[{x:r,y:n},t]});return this.draw.linkGroup(i,t)},flower:function(t){var e=this,r=[],n=this.vertices(t);r.push(n);var i=0;return function o(n){if(!(i>4)){var a=t.r/Math.pow(2,i++),s=e.vertices(_.extend({},t,{r:a}));r.push(s),n.map(function(t,e){var n=[t,s[e==s.length-1?0:e+1]];r.push(n)}),o(s)}}(n),e.draw.linkGroup(r,t)},sunflower:function(t){for(var e=t.interval||2,r=[],n=this.vertices(t),i=n.length,o=0;o<i;o++){var a=[];a.push(n[o]),a.push(n[(o+e)%i]),r.push(a)}return this.draw.linkGroup(r,t)},sierpinski:function(t){var e=this,r=[],n=this.vertices(t);return r.push(n),function i(t){var n=e.invertices.call(e,t);n&&(r.push(n),t.map(function(t,e){var r=[t,n[e],n[0==e?n.length-1:e-1]];i(r)}))}(n),e.draw.linkGroup(r,t)},inpolygon:function(t){var e=this,r=[],n=this.vertices(t);return r.push(n),function i(t){var n=e.invertices.call(e,t);n&&(r.push(n),i(n))}(n),e.draw.linkGroup(r,t)},mirror:function(t){var e=[],r=this.vertices(t);return e.push(r),r.forEach(function(t){var n=[];r.forEach(function(e){n.push(e.mirror(t))}),e.push(n)}),this.draw.linkGroup(e,t)}},_shape.prototype.init.prototype=_shape.prototype;var _shapeGroup=_.group=function(t,e){return new _shapeGroup.prototype.init(t,e)};_shapeGroup.prototype={constructor:_shapeGroup,init:function(t,e){this.draw=t,this.context=t.context,this.canvas=t.canvas;var r=(e.shape.x,e.shape.y,e.shape.r),n=(e.shape.color,e.shape.shape||"circle",e.group.colorful),i=3;e.motion&&(i=e.motion.speed||3);var o=r,a=r;"on"==e.group["switch"]&&["mirror","surround"].indexOf(e.group.group)!=-1&&(o=e.group.sr+r,a=e.group.sr+r),e.motion&&"on"==e.motion["switch"]&&(e.group.animate=!1,_.isUndefined(e.group.a)&&(e.group.a=0));var s=[],c=e.group.interval||1;switch(n){case"random":for(var l=0;l<360/c;l++)s.push(_.rgba());break;case"gradient":s=_.gradientColor(_.rgb(),_.rgb(),360/c);break;case"singleGradient":s=_.gradientColor(_.deepColor(),"#ffffff",360/c);case"solid":}e.group=_.extend({},e.group,{speed:i,width:o,height:a,range:{top:0,left:0,right:this.canvas.width,bottom:this.canvas.height},colorArr:s}),this.opt=_.extend({},e),this.setup()},shape:function(t){this.draw.shape(t.shape)},color:function(t){var e=t.group.colorful,r=t.shape.fill,n={};return e&&(r?n.color=_.rgba():n.color=_.rgb()),n},setup:function(t){var t=t||this.opt;"on"==t.group["switch"]?this[t.group.group](t):this.shape(t)},rotate:function(){return this.opt.group.a+=this.opt.group.speed,this},bounce:function(){var t=this.opt.group;t.x<t.range.left+t.width?(t.x=t.width,t.vx=-t.vx):t.y<t.range.top+t.height?(t.y=t.height,t.vy=-t.vy):t.x>t.range.right-t.width?(t.x=t.range.right-t.width,t.vx=-t.vx):t.y>t.range.bottom-t.height&&(t.y=t.range.bottom-t.height,t.vy=-t.vy)},move:function(){var t=this.opt.group;return t.x+=t.vx,t.y+=t.vy,this.opt.motion.bounce&&this.bounce(),this},ring:function(t){this.shape(t);var e=t.shape.r*t.shape.rRatio;return t.shape=_.extend({},t.shape,{r:e}),this.shape(t),this},surround:function(t){var e=this,r=t.shape.r,n=t.group.rotation,i=t.group.interval||1,o=t.group.spiral,a=t.group.x,s=t.group.y,c=t.group.sr;_.isUndefined(c)&&(c=r,r/=3);var l,u,h=t.group.clockwise,f=t.group.a||0;h?(l=f+360,u=f,o&&(l*=o)):(l=f,u=f+360,o&&(u*=o));var p=l,d=t.group.animationInterval||5,g=0;return function v(){if(!(r<5)){if(h){if(p<=u)return;p-=i,o&&(r=r*p/360/o)}else{if(p>=u)return;p+=i,o&&(r=r*(u-p)/360/o)}n&&(t.shape.a=p);var l={x:a+c*_.sin(p),y:s+c*_.cos(p),r:r};t.group.colorArr.length>g&&(l.color=t.group.colorArr[g++]),t.shape=_.extend({},t.shape,l),e.shape(t),t.group.showRadius&&e.draw.link([{x:a,y:s},{x:t.shape.x,y:t.shape.y}]),t.group.animate?setTimeout(v,d):v()}}(),t.group.showCenter&&e.draw.shape({shape:"circle",r:3,x:a,y:s,color:t.group.colorArr[0],fill:!0}),e},concentric:function(t){var e=this,r=t.shape.r,n=t.group.interval||1,i=t.group.animationInterval||5;return function o(){r<=0||(t.shape=_.extend({},t.shape,e.color(t),{r:r}),e.shape(t),r-=n,t.group.animate?setTimeout(o,i):o())}(),e},excircle:function(t){return this.shape(t),t.shape=_.extend({},t.shape,{shape:"circle",text:""}),this.shape(t),this},repeat:function(t){var e=this,r=this.canvas,n=r.width,i=r.height,o=t.group.interval||t.shape.r,a=n%o,s=i%o,c=t.group.animate,l=t.group.animationInterval||5,u=t.group.clockwise,h=o+s/2,f=o+a/2,p=n-o-a/2;return t.shape.y=h,u?t.shape.x=f:t.shape.x=p,function d(){if(u){if(t.shape.x>n)return;t.shape.y>i&&(t.shape.y=h,t.shape.x+=2*o)}else{if(t.shape.x<o)return;t.shape.y>i&&(t.shape.y=h,t.shape.x-=2*o)}t.shape=_.extend({},t.shape,e.color(t)),e.shape.call(e,t),t.shape.y+=2*o,c?setTimeout(d,l):d()}(),e}},_shapeGroup.prototype.init.prototype=_shapeGroup.prototype;var _motion=_.motion=function(t,e){return new _motion.prototype.init(t,e)};_motion.prototype={constructor:_motion,init:function(t,e){this.draw=t,this.mode=e.motion.mode,this.link=e.motion.link,this.speed=e.motion.speed||1;var r=e.motion.num||1,n=e.motion.colorful;"on"==e.motion["switch"]&&(e.shape.animate=!1),this.groups=[];for(var i=0;i<r;i++){e.id=i;var o;e.group&&"on"==e.group["switch"]?(this.mode=_.camelCase(e.motion.mode,"group"),e.group=_.extend({},e.group,{vx:(2*Math.random()-1)*e.motion.speed||1,vy:(2*Math.random()-1)*e.motion.speed||1,bounce:e.motion.bounce}),o=t.group(e)):(e.shape=_.extend({},e.shape,{vx:(2*Math.random()-1)*e.motion.speed||1,vy:(2*Math.random()-1)*e.motion.speed||1,bounce:e.motion.bounce}),o=t.shape(e.shape),o.color(n)),this.groups.push(o)}this.movie()},movie:function(){var t=this,e=t.groups,r=e.length,n=t.mode;t.draw.clear(),e.forEach(function(i,o){switch(n){case"rotation":case"rotationGroup":i.rotate(t.speed).setup();break;case"move":case"moveGroup":i.move().setup();break;default:i.move().setup()}if(t.link)for(var a=o;a<r-1;a++){var s;s="moveGroup"==n?[i.opt.group,e[a+1].opt.group]:[i.opt,e[a+1].opt],
t.draw.link(s)}}),t.draw.canvas.callback&&t.draw.canvas.callback.call(t.draw.context,t.draw.context),inBrowser?t.id=requestAnimationFrame(t.movie.bind(t)):t.id=setTimeout(t.movie.bind(t),17)},stop:function(){inBrowser?this.id&&cancelAnimationFrame(this.id):this.id&&clearTimeout(this.id)}},_motion.prototype.init.prototype=_motion.prototype;var createOptCycle=_.createOptCycle=function(t){var e={data:{},methods:{autoNext:function(t,r){if(inBrowser){var n=t.closest(".tab-body-item").attr("name"),i=t.name,o=t.checked;e.data[n][i].auto=o,console.log(i,o)}}},filters:{toggle:function(t){return 1==t?"是":"否"},color:function(t){return inBrowser?t+'<div class="colorblock" style="background-color:'+t+'"></div>':t}}},r=function(t,e){var r;if(inBrowser){var n=t.closest(".tab-body-item").query(".switchBody");t.hasClass("on")?(r="off",[t,n].removeClass("on").addClass("off")):(r="on",[t,n].removeClass("off").addClass("on")),"motion"==e&&("on"==r?_.show("#stopBtn"):_.hide("#stopBtn"))}else r="on"==this?"off":"on";return r},n=function(t,r){e.methods[_.camelCase("next",t,r)]=function(t,r){var n,i=this[0],o=this[1];if(e.data[i][o]&&(n=e.data[i][o].value=!e.data[i][o].value),inBrowser){t&&t.html(e.filters.toggle(n));var a=_.pos(t),s=a.width,c=a.height,l=document.createElement("div"),u="rgba(0,0,0,0.1)";l.css({width:s,height:c,top:0,left:0,position:"absolute",background:u}),t.appendChild(l),setTimeout(function(){l.remove()},200)}return e}.bind([t,r])},i=function(t,n){e.methods[_.camelCase("next",t,n)]=function(t,n){var i=this[0],o=this[1],a=e.data[i][o];if(_.isString(a))e.data[i][o]=r.call(e.data[i][o],t,i);else if(_.isObject(a))if(inBrowser){var s=_.pos(t),c=_.pos(n),l=s.width,u=s.height,h=c.x-s.x,f=document.createElement("div"),p=document.createElement("div"),d="rgba(0,0,0,0.1)";h>l/2?(a.next(),f.css({width:l/2,height:u,top:0,left:l/2,position:"absolute",background:d}),p.addClass("rightArrow"),p.pos({x:l-20,y:(u-20)/2})):(a.prev(),p.addClass("leftArrow"),p.pos({x:20,y:(u-20)/2}),f.css({width:l/2,height:u,top:0,left:0,position:"absolute",background:d}));var g=a.val();["color","lineColor"].indexOf(o)>=0&&(g=e.filters.color(g)),t&&t.html(_.isObject(g)?g.text:g),t.appendChild(f),t.appendChild(p),setTimeout(function(){p.remove(),f.remove()},200)}else a.next(),console.log(a.val())}.bind([t,n])};for(var o in t){var a=t[o];if(_.isObject(a)){e.data[o]={};for(var s in a){var c=a[s];if("switch"==s)e.data[o][s]=c,i(o,s);else{var l=c.type,u=null;switch(l){case"picker":u=_.cycle(c.values,c.index||0);break;case"slider":u=_.sliderCycle(c);break;case"color":case"color_rgba":case"color_rgb":for(var h=[],f=c.length||15;f--;)"color_rgba"==l?h.push(_.rgba()):"color_rgb"==l?h.push(_.rgb()):h.push(_.color());u=_.cycle(h,0);break;case void 0:_.isBoolean(c)?(u=_.cycle([{key:!0,text:"是"},{key:!1,text:"否"}],c?0:1),u.type="toggle",u.value=c,n(o,s,c)):_.isObject(c)?_.isBoolean(c.value)&&(u=_.cycle([{key:!0,text:"是"},{key:!1,text:"否"}],c.value?0:1),u.type="toggle",u.value=c.value,n(o,s,c)):_.isString(c)&&(e.data[o][s]=c)}u&&(c.text&&(u.text=c.text),c.auto&&(u.auto=c.auto),c.type&&(u.type=c.type),e.data[o][s]=u,i(o,s))}}}}return e.init=function(){var t={};for(var r in e.data){var n=e.data[r];if(_.isObject(n)){t[r]={};for(var i in n){var o=n[i];_.isBoolean(o)?t[r][i]=o:_.isObject(o)?_.isBoolean(o.value)?(t[r][i]=o.value,o.auto&&(o.value=!o.value)):(t[r][i]=_.isObject(o.val())?o.val().key:o.val(),o.auto&&o.next&&o.next()):_.isString(o)&&(t[r][i]=o)}}}return t},e.viewData=function(){var t=e.data,r={tabs:[]};for(var n in t){var i={key:n,items:[],"switch":"none",active:!1};r.tabs.push(i);var o=t[n];if(_.isObject(o))for(var a in o){var s=o[a];if("text"==a)i[a]=s;else if("switch"==a)i[a]=s,i[a+"Method"]=_.camelCase("next",n,a);else if("active"==a)i[a]=s;else{var c={key:a,value:s,text:a,method:_.camelCase("next",n,a),id:n+"_"+a};_.isBoolean(s)?(c.filter="toggle",c.value=e.filters.toggle(s)):_.isNumber(s)?c.filter="string":_.isObject(s)?(c=_.extendMe(c,s),_.isBoolean(s.value)?c.value=e.filters.toggle(s.value):_.isObject(s.val())?c.value=s.val().text?s.val().text:s.val():["color","lineColor"].indexOf(c.key)>=0?c.value=e.filters.color(s.val()):c.value=s.val()):c.filter=a,i.items.push(c)}}}return r},e},draw=_.draw=function(t,e){return new draw.prototype.init(t,e)};draw.prototype={constructor:draw,init:function(t,e){if(e)this.canvas=e,inBrowser?this.context=this.canvas.getContext("2d"):this.context=e.context;else if(inBrowser){if(t.el){var r=_.$(t.el);"canvas"==r.nodeName.toLowerCase()?this.canvas=r:(this.canvas=document.createElement("canvas"),r.appendChild(this.canvas))}else t.canvasid?(this.canvas=_.$("#"+t.canvasid),0==this.canvas.length&&(this.canvas=document.createElement("canvas"),this.canvas.id=t.canvasid)):this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d")}if(_.isObject(t)){this.options=t,this.attr(t);var n=t.background||t["background-color"],i=t["background-image"],o=t["background-size"],a=t["background-position"],s=t["background-repeat"];this.background({color:n,src:i,size:o,position:a,repeat:s}),this.callback=t.callback}return this},ratio:function(t){var e=this.canvas.parent()||document.documentElement,r={w:e.clientWidth,h:e.clientHeight},n=r.w,i=r.h;return _.isString(t)?t.indexOf(":")>=0?t.replace(/(\d+):(\d+)/,function(t,e,r){i=n*r/e}):i=n*parseFloat(t):_.isNumber(t)&&(i=n*t),this.canvas.setAttribute("width",n),this.canvas.setAttribute("height",i),this},fullscreen:function(){return this.ratio("fullscreen")},attr:function(t){for(var e in t)"ratio"==e&&this.ratio(t[e]),["width","height"].indexOf(e)>=0&&(this.canvas[e]=t[e]);return this},background:function(t){var e=this,r=e.canvas,n=e.context,i=t.src,o=t.size,a=t.position,s=t.repeat,c=t.color;return c&&(e.setFillStyle(c),n.fillRect(0,0,r.width,r.height)),i&&_.loadImg(i,function(t){var i=t.width,c=t.height,l=r.width,u=r.height;switch(o){case"cover":var h=_.max(l/i,u/c),f=i*h,p=c*h;if("center"==a){var d=h<=1?(l-f)/2:-(l-f)/2,g=h<=1?(u-p)/2:-(u-p)/2;n.drawImage(t,d,g,f,p)}else n.drawImage(t,0,0,f,p);break;case"contain":var h=_.min(l/i,u/c),f=i*h,p=c*h;if("center"==a){var d=(l-f)/2,g=(u-p)/2;n.drawImage(t,d,g,f,p)}else n.drawImage(t,0,0,f,p);"repeat"==s&&_.zipImg({img:t,zoom:h,callback:function(){var t=n.createPattern(this,"repeat");e.setFillStyle(t),n.fillRect(0,0,r.width,r.height),n.fill()}});break;case"stretch":n.drawImage(t,0,0,r.width,r.height);break;case"auto":n.drawImage(t,0,0);break;default:n.drawImage(t,0,0)}}),this},toImage:function(){return this.canvas.toDataURL("image/jpeg")},toButton:function(t){return this.toElement({className:"btn",type:t})},toElement:function(t){var e=t.tag||t.nodeName||"div",r=document.createElement(e);switch(r.className=t["class"]||t.className,t.type){case"img":var n=document.createElement("img");n.src=this.toImage(),r.appendChild(n);break;case"background":r.style.backgroundImage="url("+this.toImage()+")";break;case"canvas":var i=this.canvas,o=_.draw(this.options),a=this.context.getImageData(0,0,i.width,i.height);o.context.putImageData(a,0,0),r.appendChild(o.canvas);break;default:r.appendChild(this.canvas)}return r},save:function(){this.context.save()},restore:function(){this.context.restore()},setFillStyle:function(t){var t=_.isUndefined(t)?"#000000":t,e=this.context;e.fillStyle=t,e.setFillStyle&&e.setFillStyle(t)},setStrokeStyle:function(t){var t=_.isUndefined(t)?"#000000":t,e=this.context;e.strokeStyle=t,e.setStrokeStyle&&e.setStrokeStyle(t)},setLineWidth:function(t){var e=this.context,t=_.isUndefined(t)?.5:t;e.lineWidth=t,e.setLineWidth&&e.setLineWidth(t)},fill:function(t){var e=this.context;return t&&(t.randomColor&&(t.color=_.rgba()),t.fill&&(this.setFillStyle(t.color),e.fill())),this},stroke:function(t){var e=this.context;return t?(this.setLineWidth(t.lineWidth),t.randomColor&&(t.color=_.rgb()),(_.isUndefined(t.stroke)||t.stroke)&&(this.setStrokeStyle(t.lineColor||t.color),e.stroke())):e.stroke(),this},render:function(t){return this.fill(t).stroke(t),this},closePath:function(t){var e=this.context;if(t){var r=!!_.isUndefined(t.closed)||t.closed;r&&e.closePath()}else e.closePath()},beginPath:function(t){var e=this.context;if(t){var r=!!_.isUndefined(t.begin)||t.begin;r&&e.beginPath()}else e.beginPath()},clear:function(t){var e=this.canvas,r=this.context;r.clearRect(0,0,e.width,e.height)},central:function(){var t=this.canvas;return{x:t.width/2,y:t.height/2}},"default":function(t){var e=this.canvas;return t?_.extend({},this["default"](),t):{x:e.width/2,y:e.height/2,r:10,color:_.color()}},shortName:function(t){return t&&[{k:"n",v:"num"},{k:"s",v:"shape"},{k:"showR",v:"showRadius"},{k:"showV",v:"showVertices"},{k:"showC",v:"showCenter"},{k:"showEC",v:"showExcircle"}].forEach(function(e){_.isUndefined(t[e.k])||(t[e.v]=t[e.k])}),t},link:function(t,e){var r=this,n=this.context;if(this.beginPath(e),t.forEach(function(t,e){t&&(0==e?n.moveTo(t.x,t.y):n.lineTo(t.x,t.y))}),r.closePath(e),r.render(e),e){if(e.showExcircle&&(e.text="",r.shape().circle(e)),e.showRadius){var i=e.x,o=e.y;n.beginPath(),t.forEach(function(t){n.moveTo(i,o),n.lineTo(t.x,t.y)}),r.render(e)}var a=r.shape(),s=_.rgb();if(e.showVertices||e.identifierVertices){var c=e.animate,l=e.animationInterval||200;t.forEach(function(t,r){t.fill=!0,e.identifierVertices?(t.r=10,t.text=r+1,t.color="rgba(0,0,0,0.2)"):(t.color=s,t.r=3),c?setTimeout(function(){a.circle(t)},l*r):a.circle(t)})}e.showCenter&&a.circle({r:3,x:e.x,y:e.y,color:s,fill:!0})}return this},linkGroup:function(t,e){var r=this;return e&&e.animate?t.forEach(function(t,n){setTimeout(function(){r.link(t,e)},200*n)}):t.forEach(function(t){r.link(t,e)}),r},shape:function(t){return t=this.shortName(t),_.shape(this,t)},group:function(t){t.group=this.shortName(t.group),t.group=this["default"](t.group),t.shape=this["default"](t.shape);var e;return e=t.group&&"on"==t.group["switch"]?_shapeGroup(this,t):this.shape(t.shape),this.canvas.callback&&this.canvas.callback.call(this.context,this.context),e},motion:function(t){return t.motion=this.shortName(t.motion),_motion(this,t)},setup:function(t){this.motionCache&&this.motionCache.stop(),t.motion&&"on"==t.motion["switch"]?this.motionCache=this.motion(t):this.group(t)},stop:function(){this.motionCache&&this.motionCache.stop()},path:function(t){var e=this,t=e["default"](t)},verticesGroup:function(t){var e=this,r=e.vertices(t.group),n=[];return r.forEach(function(r){var i=e.vertices(_.extend({},t.shape,{x:r.x,y:r.y}));n.push(i)}),n},translate:function(t,e,r){for(var t=this["default"](t),n=[],i=t.interval||10,o=t.step||1,a=t.direction||0,s=(t.x,t.y,0);s<o;s++){var c=_.point(_.extend(t,{r:i,a:a}));n.push(c)}return n},translateX:function(t,e){},translateY:function(t,e){},scale:function(){},grid:function(t){for(var e=this.canvas,t=this["default"](t),r=t.interval||10,n=[],i=r+.5;i<e.width;i+=r){var o=[];o.push({x:i,y:0}),o.push({x:i,y:e.height}),n.push(o)}for(var i=r+.5;i<e.height;i+=r){var o=[];o.push({x:0,y:i}),o.push({x:e.width,y:i}),n.push(o)}return this.linkGroup(n,t)},escribedcircle:function(t){},incircle:function(t){}},draw.prototype.init.prototype=draw.prototype;var tasker=_.tasker=function(t){return new tasker.prototype.init(t)};tasker.prototype={constructor:tasker,init:function(t){var e=t.file,r=(this.data=t.data,t.callback);return"undefined"!=typeof Worker&&("undefined"==typeof this.w&&(this.w=new Worker(e)),this.w.addEventListener("message",function(t){console.log(t.data),r&&r(t.data)})),this},open:function(t,e){return this.w.postMessage({name:t,act:"open",cfg:_.extend({},this.data,e)}),console.log("task open: "+t),this},close:function(t){return this.w.postMessage({name:t,act:"close"}),console.log("task close: "+t),this}},tasker.prototype.init.prototype=tasker.prototype;var scroller=_.scroller=function(t){return new scroller.prototype.init(t)};scroller.prototype={constructor:scroller,init:function(t){var e=this;if(t){var r=function(){toucher({el:e.el,type:"scroll",callback:function(){e.onScroll&&e.onScroll.call(e.el)}})};e.root=document.body,_.isObject(t)?(e.el=t.el?_.query(t.el):e.root,e.onTop=t.onTop,e.onBottom=t.onBottom,e.onScroll=t.onScroll):_.isString(t)?e.el=_.query(t):_.isFunction(t)&&(e.el=e.root,e.onScroll=t),e.onScroll&&r()}else e.el=e.root;e.isRoot=["HTMLHtmlElement","HTMLBodyElement","htmldocument"].map(function(t){return t.toLowerCase()}).indexOf(_.type(e.el))>=0,e.isRoot?e.scrollTop=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0:e.scrollTop=e.el.scrollTop},toView:function(t){t=_.query(t)||this.el,t.scrollIntoView()},atTop:function(){return 0==this.el.scrollTop},atBottom:function(){return this.isRoot?this.el.scrollTop+this.el.clientHeight==this.el.offsetHeight:this.el.scrollTop+this.el.clientHeight==this.el.scrollHeight},toTop:function(t){this.el.scrollTop=0,t&&t.call(this.el)},toBottom:function(t){this.el.scrollTop=this.el.scrollHeight,t&&t.call(this.el)},scrollpage:function(t,e){var r=this,n=e||10;switch(r.timer&&clearTimeout(r.timer),r.srollerTimer&&clearTimeout(r.srollerTimer),t){case"up":r.el.scrollTop-=n;break;case"down":r.el.scrollTop+=n}e||(r.timer=setTimeout(function(){r.scrollpage.call(r,t)},17))},to:function(t,e){window.scrollTo(t,e)},up:function(t){this.scrollpage.call(this,"up",t)},down:function(t){this.scrollpage.call(this,"down",t)},stop:function(){this.timer&&clearTimeout(this.timer)}},scroller.prototype.init.prototype=scroller.prototype;var router=_.router=function(t){return new router.prototype.init(t)};router.prototype={constructor:router,pageStack:[],configs:[],pageAppend:function(){},defaultPage:null,pageIndex:1,routes:{},defaultAction:"home",init:function(t){var e=this;t&&(this.routes=t),addEvent("hashchange",window,function(){var t=e.parseUrl();e._go(t.route)}),history.state&&history.state.pageIndex&&(this.pageIndex=history.state.pageIndex),this.pageIndex--;var r=0===location.hash.indexOf("#")?location.hash:"#",n=e._find("url",r)||e.defaultPage;return this._go(n),this},getAction:function(t){return this.routes[t]?this.routes[t]:this.defaultAction},getSearch:function(){var t=location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(){var t=location.href.match(/#(.*)$/);return t?t[1]:""},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getPath:function(){var t=this.decodeFragment(location.pathname+this.getSearch()).slice(0);return"/"===t.charAt(0)?t.slice(1):t},parseUrl:function(){var t={},e=location.href,r=location.hash,n=r,i=function(){var t=location.href.match(/#(.*)$/);return t?t[1]:""},o=this.getPath();return r=i(),e.replace(/[?&](.+?)=([^&#]*)/g,function(_,e,r){t[e]=decodeURI(r)}),r&&(r=r.length>1?r.replace(/#+/g,"#"):"",n=r.replace(/#/g,"")),{params:t,hash:r,route:n,path:o}},push:function(t){return this.configs.push(t),this},go:function(t){t&&(location.hash=t)},_go:function(t){this.pageIndex++,history.replaceState&&history.replaceState({pageIndex:this.pageIndex},"",location.href);var e=this.getAction(t);_.isFunction(e)?e.call(this):console.log(e),console.log(this.pageIndex)},back:function(){history.back()},_back:function(t){this.pageIndex--;var e=this.pageStack.pop();if(e){var r=0===location.hash.indexOf("#")?location.hash:"#",n=this._findInStack(r);if(!n){var i=_.$(t.template).addClass("js_show").addClass(t.name);i.insertBefore(e.dom),t.isBind||this._bind(t),this.pageStack.push({config:t,dom:i})}return this}},_findInStack:function(t){for(var e=null,r=0,n=this.pageStack.length;r<n;r++){var i=this.pageStack[r];if(i.config.url===t){e=i;break}}return e},_find:function(t,e){for(var r=null,n=0,i=this.configs.length;n<i;n++)if(this.configs[n][t]===e){r=this.configs[n];break}if(!r){var r={template:e,id:e,url:e};r[t]=e,this.push(r)}return r},_bind:function(t){var e=t.events||{};for(var r in e)for(var n in e[r]);t.isBind=!0}},router.prototype.init.prototype=router.prototype;var StandardFilters={string:function(t){return(_.isArray(t)||_.isObject(t))&&(t=_.stringify(t)),t},first:function(t){return _.isArray(t)&&(t=t[0]),t},last:function(t){return _.isArray(t)&&(t=t[t.length-1]),t},pre:function(t){return _.preHtml(t)},"int":function(t){return _.isNumber(Number(t))?Math.round(Number(t)):t},number:function(t){return Number(t)},wan:function(t){return Number(t)>1e4?(Number(t)/1e4).toFixed(1)+"万":t},fixed:function(t){return Number(t).toFixed(1)},cent:function(t){return(Number(t)/100).toFixed(2)},percent:function(t){return Math.ceil(100*t)+"%"},yearmonth:function(t){return new Date(Number(t)).format("YYYY年MM月")},monthdaytime:function(t){return new Date(Number(t)).format("MM月DD日 HH:mm")},datetime:function(t){return new Date(Number(t)).format("YYYY-MM-DD HH:mm")},date:function(t){return new Date(Number(t)).format("YYYY-MM-DD")},time:function(t){return new Date(Number(t)).format("HH:mm")},avatar:function(t){return t?' style="background-image: url('+t+');"':""},file:function(t){return"<div data-file='"+t+"'></div>"},text:function(t){return _.escape(t)}};["markdown","escape","unescape"].forEach(function(t){StandardFilters[t]=function(e){return _[t](e)}}),["round","ceil","floor"].forEach(function(t){StandardFilters[t]=function(e){return _.isNumber(Number(e))?Math[t](Number(e)):e}});var callFilter=function(t,e,r){if(e){var n=this,i=function(t,e,r){var i=customFilters[e];if(_.isUndefined(i))return t;if(_.isFunction(i))t=i.call(n,t,r);else try{var o=new Function("return ("+i+".call(this,arguments[0]));");t=o.call(n,t,r)}catch(a){console.log(a);try{var o=new Function("data","return ("+i+");");t=o.call(n,t,r)}catch(a){console.log(a),t=i}}return t},o=(""+e).split(","),a=o.length;a>0&&"string"!=o[a-1]&&o.push("string"),o.forEach(function(e){t=i.call(n,t,e,r)})}return t},regModel=/<[^>]+?model=\"(.*?)\".*?(>.*?<)\/[^>]+?>/gi,regbind=/<[^>]+?bind=\"(.*?)\".*?(>.*?<)\/[^>]+?>/gi,preModel=function(t){var e=new RegExp([regModel.source,regbind.source].join("|")+"|$","gi");return t.replace(e,function(t,e,r,n,i){return e=e||n,r=r||i,t.replace(r,">{="+e+"}<")})},parseTag=_.parseTag=function(tpl,data){var self=this;return tpl.replace(reg_tpl_tag,function(match,name,filter){name=name.trim(),filter=(filter||"string").trim();var val="";try{if(0==filter.indexOf("$")&&(filter=eval("data."+filter.replace("$",""))),"$index"==name.toLowerCase())return $index++;if("$length"==name.toLowerCase())return $length;val="$this"==name.toLowerCase()?data:reg_operation_symbol.test(name)?data.cmd(name):_.getVal(data,name)}catch(e){console.log(e,data)}return _.isUndefined(val)&&(val=""),val=callFilter.call(self,val,filter,data)})},parseTpl=_.parseTpl=function(t){var e=t||this,r=e.tpl||getTpl(e.template),n=e.groupTpl,i=e.lazyTpl,o=e.moreTpl,a=e.defaultTpl,s=e.loop,c=e.syntax,l=e.data;if(_.isEmpty(r)&&_.isEmpty(n))return"";r&&function(){r=preModel(r)}(),$index=1;var u="";if(_.isUndefined(l))h=0,u=_.isUndefined(a)?r:a;else if(_.isArray(l)){var h=l.length,f=Number(s)||h;(o||i)&&f>=h&&(f=3);for(var p=[],d="",g="",v=0;v<h;v++){var m=l[v];if(!_.isUndefined(n)&&function(){g=parseTag.call(e,n,m),g!=d&&p.push(g),d=g}(),v>=f){if(!_.isUndefined(o)){p.push(parseTag.call(e,o,m));break}if(_.isUndefined(i))break;p.push(parseTag.call(e,i,m))}else r&&p.push(parseTag.call(e,r,m))}u=p.join("")}else _.isObject(l)?(h=1,r&&function(){u=parseTag.call(e,r,l)}()):(h=1,u=r);var c=c||customSyntax;switch(c){case"markdown":u=_.markdown(u);break;case"pre":u=_.preHtml(u)}return u},getTpl=_.getTpl=function(t){if(t){var e=_.query(t.pound());return e&&e.length>0?_.text(e).trim():null}return null},elTpl=function(t){var e,r;return _.hasAttr(this,t)&&(r=this.attr(t),e="this"==r||_.isEmpty(r)?_.html(this).trim():getTpl(r)),e},parseEl=function(){var self=this,tpl,syntax,groupTpl,lazyTpl,moreTpl,defaultTpl,loop,el=self.el,data=self.data,act=self.act,keyword=self.keyword;if(self.tpl=self.template||elTpl.call(el,TEMPLATE),[GROUP,LAZY,MORE,DEFAULT].forEach(function(t){self.templates&&!_.isUndefined(self.templates[t])?self[t+"Tpl"]=self.templates[t]:self[t+"Tpl"]=elTpl.call(el,t)}),self.tpl)loop="auto";else if(self.groupTpl);else if(tpl=el.html(),loop="1",!reg_tpl_tag.test(tpl))return parseDirective.call(self,el,data),!1;if(_.hasAttr(el,SYNTAX)&&(syntax=el.attr(SYNTAX)),_.hasAttr(el,NOLOOP)&&(loop="1"),_.hasAttr(el,LOOP)&&(loop=el.attr(LOOP)),_.hasAttr(el,PAGESIZE)&&(loop=el.attr(PAGESIZE)),_.hasAttr(el,DATA)){var child=el.attr(DATA);_.has(data,child)&&(data=eval("data."+child))}if(_.isArray(data)&&keyword&&_.hasAttr(el,KEYWORD)){var name=el.attr(KEYWORD);data=_.filter(data,function(t){var e=name.split(",");if(1==e.length)return _.has(_.getVal(t,name),keyword);var r=!1;return e.forEach(function(e){_.has(_.getVal(t,e),keyword)&&(r=!0)}),r})}$length=_.isArray(data)?data.length:_.isUndefined(data)?0:(_.isObject(data),1);var tplConfig=_.extend({},self,{data:data,loop:loop,syntax:syntax}),str=parseTpl.call(tplConfig);switch(act){case"append":str=el.html()+str;break;case"before":str+=el.html()}(self.tpl||el.attr(TEMPLATE)||el.attr(GROUP))&&el.html(str),parseDirective.call(self,el,data)},StandardDirectives={},parseDirective=function(t,e){var r=this,n=t.query(MODEL.brackets()),i=function(t,e){if(_.isElement(this)){var n=this.attr(ON),i=r.methods[n];i&&_.isFunction(i)&&i.call(r,this,e)}};StandardDirectives[ON]=i;var o;_.each(StandardDirectives,function(e,n){o=n==DRAG?DRAG:TAP;var i=_.$(n.brackets(t));if(ON!=n){var a=function(t,e){var i=r.methods["_on_"+n];i&&_.isFunction(i)&&i.call(r,t,e)};toucher({el:i,type:o,clear:!0,listener:a})}else toucher({el:i,type:o,clear:!0,listener:e})}),n&&n.length>0&&n.each(function(t,e){var r=this.attr(MODEL),n=_.query(this).val();template.prototype[r]=n;var i=_.clone(template.prototype);Object.defineProperty(template.prototype,r,{set:function(t){var e=i[r];i[r]=t,t!=e&&template.prototype.apply(r,t)},get:function(){return i[r]},enumerable:!0,configurable:!0})}),n&&n.length>0&&n.on("keyup",function(){var e=_.query(this).val(),r=this.attr(MODEL);t.query(MODEL.brackets()).html(e),console.log(e,r),template.prototype[r]=e})};return template.prototype={constructor:template,init:function(t){var e=this,r=Array.prototype.slice.call(arguments),n=r.length;switch(e.methods={},n){case 0:if(_.isEmpty(e.el))return;break;case 1:if(_.isArray(t))return void t.forEach(function(t){template(t)});_.isObject(t)&&_.each(t,function(r,n){switch(n){case"el":if(e.el=t.el,_.isString(e.el)&&(e.selector=e.el,e.el=_.query(e.el)),_.isJQuery(e.el))if(1==e.el.length)e.el=_.autoid(e.el.get(0));else{var i=[];e.el.each(function(t,e){i.push(_.autoid(t))}),e.el=i}if(!(_.isElement(e.el)||_.isArray(e.el)&&_.size(e.el)>0))return console.log("not query el"+t.el),e.el=document.createElement("div"),e.el.id=t.el.replace("#",""),t.template&&e.el.setAttribute("template",t.template.replace("#","")),t.container?_.query(t.container).appendChild(e.el):document.body.appendChild(e.el),!1;rootEl=e.el;break;case"data":e.data=t.data,_.isFunction(t.data)&&(e.data=t.data()),_.isObject(e.data)||_.isArray(e.data)||(e.data={});break;case"syntax":e.syntax=customSyntax=t.syntax;break;case"methods":e.methods=_.extend({},customMethods,r);break;default:e[n]=r}});break;default:throw new Error("invalid options ,formate should be likes: {el:el,data:data}")}customFilters=_.extend({},StandardFilters,e.filters),StandardDirectives=_.extend({},StandardDirectives,e.directives),_.each(e.directives,function(t,r){e.methods["_on_"+r]=t}),t=_.extend({},t,{el:e.el,methods:e.methods}),_.isFunction(e.before)&&e.before.call(e,e.data);var i=e.el;if("cloneBefore"==e.act){var o=_.autoid(e.el.cloneNode(!0),!0);e.el.parentNode.insertBefore(o,e.el),t.act="",i=t.el=o}if("cloneAfter"==e.act){var o=_.autoid(e.el.cloneNode(!0),!0);e.el.parentNode.appendChild(o,e.el),t.act="",i=t.el=o}if(_.isElement(i)?e.parser.call(t,i):_.isArray(i)&&_.size(i)>0&&i.each(function(r,n){e.parser.call(_.extend({},t,{el:r}),r)}),_.isFunction(e.callback)&&e.callback.call(t,e.data),e.events)if(_.isFunction(e.events))toucher({el:i,type:"tap",clear:!0,listener:e.events});else if(_.isObject(e.events)){var a=[];for(x in e.events)a.push({el:i,type:x,listener:e.events[x]});toucher(a)}},parser:function(t){var e=this;if(e.template||_.hasAttr(t,TEMPLATE)||_.hasAttr(t,GROUP))parseEl.call(e);else{var r=t.query(TEMPLATE.brackets(),GROUP.brackets());_.size(r)>0&&r.each(function(t,r){parseEl.call(_.extend({},e,{el:t}))})}},apply:function(t,e){var r=function(t,e){return t+"='"+e+"'"},n=[];n.push(r(MODEL,t).brackets()),n.push(r(BIND,t).brackets());var i=n.join(",");rootEl.query(i).each(function(t,r){switch(console.log(this.tagName,t),this.tagName.toLowerCase()){case"div":_.query(this).html(e);break;case"input":_.query(this).val(e)}})}},template.prototype=_.extend({},template.prototype,_),template.prototype.init.prototype=template.prototype,inBrowser&&(window._||(window._=_),window.tpler=_.tpler,window.toucher=_.toucher,window.walker=_.walker,window.router=_.router),template});